# reactç›¸å…³çŸ¥è¯†ç‚¹

## 1. reactç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶çš„åŒºåˆ«
### 1.1 å¯¹æ¯”æ€»è§ˆ
| ç»´åº¦        | ç±»ç»„ä»¶ï¼ˆClass Componentï¼‰                | å‡½æ•°ç»„ä»¶ï¼ˆFunction Componentï¼‰           |
| --------- | ----------------------------------- | ---------------------------------- |
| å®šä¹‰æ–¹å¼      | ä½¿ç”¨ `class`ï¼Œç»§æ‰¿è‡ª `React.Component`    | ä½¿ç”¨æ™®é€šçš„ JavaScript å‡½æ•°                |
| çŠ¶æ€ç®¡ç†      | ä½¿ç”¨ `this.state` å’Œ `this.setState()` | ä½¿ç”¨ `useState()` ç­‰ Hook             |
| ç”Ÿå‘½å‘¨æœŸ      | ä½¿ç”¨ç±»ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆå¦‚ `componentDidMount`ï¼‰    | ä½¿ç”¨ `useEffect()` æ›¿ä»£                |
| `this` é—®é¢˜ | `this` éœ€è¦ç»‘å®šï¼ˆå¦‚æ„é€ å‡½æ•°ä¸­ `.bind(this)`)   | æ— éœ€ `this`ï¼Œç›´æ¥è®¿é—® propsã€state         |
| å¯è¯»æ€§/ç®€æ´æ€§   | ç›¸å¯¹ç¹çï¼Œæœ‰å†—ä½™ä»£ç                           | ç®€æ´ã€å‡½æ•°å¼ç¼–ç¨‹é£æ ¼                         |
| Hook ä½¿ç”¨   | âŒ ä¸æ”¯æŒ                               | âœ… æ”¯æŒæ‰€æœ‰ React Hook                  |
| æ€§èƒ½ï¼ˆå°å·®å¼‚ï¼‰   | å·®åˆ«å¾ˆå°ï¼Œä¸»è¦å–å†³äºå†™æ³•                        | åŒä¸Šï¼›å‡½æ•°ç»„ä»¶å¯èƒ½æ›´æ˜“ä¼˜åŒ–ï¼ˆé…åˆ memo/useCallbackï¼‰ |
| ä»£ç å¤ç”¨      | HOCã€render props æ–¹æ¡ˆ                 | å¯ä½¿ç”¨è‡ªå®šä¹‰ Hookï¼Œå®ç°æ›´ä¼˜é›…çš„é€»è¾‘å¤ç”¨             |
| æ˜¯å¦æ¨è      | React 16.8 åä¸æ¨èæ–°å¢ä½¿ç”¨                 | âœ… å®˜æ–¹æ¨èé¦–é€‰æ–¹å¼                         |
### 1.2 ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”
| ç”Ÿå‘½å‘¨æœŸè¡Œä¸º                | ç±»ç»„ä»¶æ–¹æ³•                    | å‡½æ•°ç»„ä»¶ä¸­çš„å†™æ³•ï¼ˆHookï¼‰                                |
| --------------------- | ------------------------ | --------------------------------------------- |
| æŒ‚è½½                    | `componentDidMount()`    | `useEffect(() => { ... }, [])`                |
| æ›´æ–°                    | `componentDidUpdate()`   | `useEffect(() => { ... }, [dep])`             |
| å¸è½½                    | `componentWillUnmount()` | `useEffect(() => { return () => {...} }, [])` |
| shouldComponentUpdate | å¯æ‰‹åŠ¨æ§åˆ¶æ€§èƒ½ä¼˜åŒ–                | `React.memo` + `useMemo/useCallback`          |
### 1.3 æ€»ç»“
å‡½æ•°ç»„ä»¶ + Hooks èƒ½å®ç°ç±»ç»„ä»¶æ— æ³•ä¼˜é›…å®ç°çš„é€»è¾‘å¤ç”¨ã€çŠ¶æ€éš”ç¦»å’Œç»„åˆèƒ½åŠ›ï¼Œå…·æœ‰æ›´é«˜çš„è¡¨è¾¾åŠ›ã€å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§
### 1.4 å…¸å‹åœºæ™¯
1. é€»è¾‘å¤ç”¨
ç±»ç»„ä»¶ä¸­æƒ³å¤ç”¨é€»è¾‘ï¼Œåªèƒ½ç”¨é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰æˆ– render props
```js
// render propsï¼šä¼šäº§ç”Ÿç»„ä»¶åµŒå¥—åœ°ç‹±
<DataFetcher render={(data) => <Component data={data} />} />
```
```js
const data = useDataFetcher(url); // é€»è¾‘å¤ç”¨åƒè°ƒç”¨å‡½æ•°ä¸€æ ·è‡ªç„¶
```
2. é€»è¾‘åˆ†æ•£éš¾ç®¡ç†
ç±»ç»„ä»¶ä¸­ï¼Œä¸€ä¸ªå‰¯ä½œç”¨é€»è¾‘ï¼ˆå¦‚è®¢é˜… WebSocketï¼‰å¾€å¾€æ‹†æ•£åœ¨å¤šä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼š
```js
componentDidMount() {
  socket.subscribe();
}
componentDidUpdate() {
  if (someConditionChanged) socket.resubscribe();
}
componentWillUnmount() {
  socket.unsubscribe();
}
```
```js
useEffect(() => {
  socket.subscribe();
  return () => socket.unsubscribe();
}, [someCondition]);
```
3. åŠ¨æ€ Hook ç»„åˆ
ç±»ç»„ä»¶é‡Œæ— æ³•æŒ‰æ¡ä»¶å¼•å…¥ä¸€æ®µçŠ¶æ€é€»è¾‘ï¼Œåªèƒ½æå‰å†™å¥½æ‰€æœ‰é€»è¾‘
```js
if (isEditMode) {
  useEditableLogic();
} else {
  useReadonlyLogic();
}
```
4. ä½¿ç”¨å¤šä¸ªçŠ¶æ€é€»è¾‘æ—¶çš„éš”ç¦»æ€§å’Œå¯æµ‹è¯•æ€§
å‡½æ•°ç»„ä»¶é€šè¿‡å¤šä¸ª useState/useReducer å¯ä»¥æŠŠé€»è¾‘æ‹†å¾—å¾ˆå¹²å‡€ï¼š
```js
const [list, setList] = useListData();
const [searchTerm, setSearchTerm] = useSearch();
const [selected, setSelected] = useSelectedItem();
```
- æ¯ä¸ªçŠ¶æ€é€»è¾‘éƒ½å¯ä»¥å°è£…æˆç‹¬ç«‹çš„è‡ªå®šä¹‰ Hookï¼Œå¤©ç„¶è§£è€¦ã€æ˜“æµ‹è¯•ã€æ˜“é‡ç”¨
- ç±»ç»„ä»¶ä¼šæŠŠè¿™äº›æ··åœ¨ this.state ä¸­ï¼Œéš¾ä»¥æ‹†åˆ†é€»è¾‘ã€‚
### 1.5 æ€§èƒ½ä¼˜åŒ–æ›´æ¸…æ–°
- ğŸ‘ é€»è¾‘æ›´ç»†ç²’åº¦ã€é€æ˜ï¼šçŠ¶æ€æ˜¯æ˜¾å¼çš„ã€Hook æ˜¯å‡½æ•°ï¼Œèƒ½æ˜ç¡®è¿½è¸ªæ¯æ®µé€»è¾‘
- ğŸ”§ ä¼˜åŒ–æ‰‹æ®µç»„åˆçµæ´»ï¼šå¦‚ useMemoã€useCallbackã€React.memo é…åˆä½¿ç”¨ï¼Œç²’åº¦ç²¾å‡†
- ğŸ§± ç»„ä»¶æ˜¯çº¯å‡½æ•°ï¼ˆæ— å‰¯ä½œç”¨ï¼‰æ›´åˆ©äºä¼˜åŒ–ï¼Œä¾‹å¦‚ memoizationã€æƒ°æ€§æ¸²æŸ“ã€é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
#### ç±»ç»„ä»¶å¦‚ä½•åšæ€§èƒ½ä¼˜åŒ–
1. ä½¿ç”¨ PureComponent
```js
class MyComponent extends React.PureComponent {
  render() {
    return <div>{this.props.value}</div>;
  }
}
```
- è‡ªåŠ¨è¿›è¡Œæµ…æ¯”è¾ƒï¼ˆprops å’Œ stateï¼‰
- ä½†ä»…æµ…æ¯”è¾ƒï¼Œå¼•ç”¨ç±»å‹å˜æ›´ï¼ˆå¦‚æ•°ç»„ã€å¯¹è±¡ï¼‰å®¹æ˜“è§¦å‘è¯¯æ›´æ–°æˆ–è¯¯è·³è¿‡
2. ä½¿ç”¨ shouldComponentUpdate æ‰‹åŠ¨æ§åˆ¶æ›´æ–°
```js
class MyComponent extends React.Component {
  shouldComponentUpdate(nextProps, nextState) {
    return nextProps.value !== this.props.value;
  }
}
```
- ç²¾ç»†æ§åˆ¶æ›´æ–°é€»è¾‘
- å¯è¯»æ€§å·®ã€æ˜“é”™ï¼›å¤šä¸ª props æ—¶é€»è¾‘åºæ‚ï¼Œä¸åˆ©äºç»´æŠ¤
3. ä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„ï¼ˆé…åˆ Reduxã€Immutable.jsï¼‰
- é¿å…å¼•ç”¨åœ°å€ä¸å˜å¯¼è‡´ä¸æ›´æ–°
- å®é™…æ•ˆæœä¸å¦‚ Hook ç›´è§‚
4. æ€»ç»“ç±»ç»„ä»¶ç—›ç‚¹
- æ€§èƒ½ä¼˜åŒ–â€œéšè—â€åœ¨ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œä¸é€æ˜
- æ˜“é—æ¼ shouldComponentUpdateï¼Œå¯¼è‡´å…¨é‡é‡æ¸²æŸ“
- å¤šä¸ªçŠ¶æ€ã€å¤æ‚ä¾èµ–ä¸‹ï¼Œä¸æ˜“å®šä½é—®é¢˜ç‚¹
#### å‡½æ•°å¼ç»„ä»¶è¿›è¡Œæ€§èƒ½ä¼˜åŒ–
1. React.memo(Component)
åŠŸèƒ½ï¼šå¯¹ç»„ä»¶è¿›è¡Œæµ…æ¯”è¾ƒï¼ˆObject.isï¼‰ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼ˆç­‰ä»·äº PureComponentï¼‰
```js
const MyComponent = React.memo(function MyComponent({ value }) {
  return <div>{value}</div>;
});
```
æ¨èä½¿ç”¨åœ¨çº¯æ˜¾ç¤ºå‹ç»„ä»¶æˆ– props ä¸ç»å¸¸å˜çš„ç»„ä»¶ä¸­
2. useMemo()
åŠŸèƒ½ï¼šç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—
```js
const expensiveValue = useMemo(() => computeExpensive(a, b), [a, b]);
```
ç”¨äºæ€§èƒ½æ•æ„Ÿçš„è®¡ç®—é€»è¾‘ï¼ˆå¦‚æ’åºã€è¿‡æ»¤ã€å¤§æ•°æ®æ¸²æŸ“ï¼‰
3. useCallback()
åŠŸèƒ½ï¼šç¼“å­˜å‡½æ•°å¼•ç”¨ï¼Œé˜²æ­¢å­ç»„ä»¶å› å‡½æ•°å˜åŒ–è€Œé‡å¤æ¸²æŸ“ã€‚
```js
const handleClick = useCallback(() => {
  console.log('clicked');
}, []);
```
ç”¨äºå°†å›è°ƒä¼ å…¥ memo åŒ–å­ç»„ä»¶æ—¶ï¼Œä¿æŒå¼•ç”¨ç¨³
4. useTransition()ã€useDeferredValue()
åŠŸèƒ½ï¼šå¼‚æ­¥ UI æ›´æ–°ã€å»¶è¿Ÿæ¸²æŸ“ï¼Œæå‡æµç•…åº¦
```js
const deferredValue = useDeferredValue(searchTerm);
```
#### æ€»ç»“å¯¹æ¯”
| ä¼˜åŒ–ç­–ç•¥          | ç±»ç»„ä»¶                     | å‡½æ•°ç»„ä»¶                              |
| ------------- | ----------------------- | --------------------------------- |
| æµ…æ¯”è¾ƒä¼˜åŒ–         | `PureComponent`         | `React.memo()`                    |
| æ‰‹åŠ¨æ›´æ–°æ§åˆ¶        | `shouldComponentUpdate` | `React.memo()` + props æ§åˆ¶         |
| å‡½æ•°ç¼“å­˜          | éœ€è¦æ‰‹åŠ¨ bind æˆ–å®šä¹‰å‡½æ•°         | âœ… `useCallback()`                 |
| è®¡ç®—ç¼“å­˜          | æ—                        | âœ… `useMemo()`                     |
| å¼‚æ­¥æ¸²æŸ“/å»¶è¿Ÿæ›´æ–°     | æ—                        | âœ… `useTransition()` ç­‰ React 18 ç‰¹æ€§ |
| ç”Ÿå‘½å‘¨æœŸä¼˜åŒ–ï¼ˆå‰¯ä½œç”¨åˆå¹¶ï¼‰ | æ‹†åœ¨å¤šä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­             | âœ… `useEffect()` é›†ä¸­ç®¡ç†å‰¯ä½œç”¨           |
| æ€§èƒ½åˆ†æä¸å®šä½       | éš¾ä»¥ç²¾å‡†å®šä½ã€åµŒå¥—é€»è¾‘å¤æ‚           | âœ… é€»è¾‘åˆ†æ˜ï¼Œæ˜“æ’æ¡©ä¸ç›‘æ§                     |
#### æœ€ä½³å®è·µ
- é»˜è®¤ä½¿ç”¨å‡½æ•°ç»„ä»¶ï¼Œé…åˆ React.memo å’Œ useCallback æ˜¯æœ€ç¨³å¦¥çš„åšæ³•
- çŠ¶æ€æ‹†åˆ†æˆå¤šä¸ª useState / useReducerï¼Œé€»è¾‘åˆ†ç¦»æ›´åˆ©äºä¼˜åŒ–
- ç”¨ useMemo ç¼“å­˜é‡è®¡ç®—æ•°æ®ï¼Œæ¯”å¦‚ç­›é€‰ã€æ’åºã€è½¬æ¢
- å­ç»„ä»¶ä¸è¦ä¼ é€’æ–°å»ºçš„åŒ¿åå‡½æ•°ï¼ˆå®¹æ˜“ç ´å memoï¼‰
- å¦‚æœå­ç»„ä»¶ props å¾ˆå¤æ‚ï¼Œè€ƒè™‘æ‹†åˆ†æˆæ›´å°çš„ memo åŒ–ç»„ä»¶

---

## 2. reactå‡½æ•°ç»„ä»¶æœ‰ä»€ä¹ˆç‰¹æ€§
### 2.1 ä¸€å¥è¯é‡ç‚¹
React å‡½æ•°ç»„ä»¶æ˜¯çº¯å‡½æ•°å¼å£°æ˜ UI çš„ç»„ä»¶ï¼Œå¤©ç„¶æ”¯æŒ Hooksï¼Œç”¨æ›´ç®€æ´ã€ç»„åˆåŒ–çš„æ–¹å¼æ„å»ºç»„ä»¶é€»è¾‘ï¼Œæ˜¯ç°ä»£ React çš„æ ¸å¿ƒç»„ä»¶æ¨¡å‹
### 2.2 å‡½æ•°ç»„ä»¶çš„æ ¸å¿ƒç‰¹æ€§
| ç‰¹æ€§                  | è¯´æ˜                                                 |
| ------------------- | -------------------------------------------------- |
| âœ… æœ¬è´¨æ˜¯ä¸€ä¸ª JS å‡½æ•°       | ä»¥å‡½æ•°å½¢å¼å®šä¹‰ï¼Œå‚æ•°æ˜¯ `props`ï¼Œè¿”å›å€¼æ˜¯ JSXï¼ˆå³ Virtual DOMï¼‰        |
| âœ… æ—  `this`          | ä¸éœ€è¦ç»‘å®š `this`ï¼Œæ— å®ä¾‹ï¼Œè®¿é—®çŠ¶æ€å’Œæ–¹æ³•æ›´æ¸…æ™°                        |
| âœ… æ”¯æŒ React Hooks    | å¯ä»¥ä½¿ç”¨ `useState`ã€`useEffect` ç­‰ Hook æ·»åŠ çŠ¶æ€ã€å‰¯ä½œç”¨ç­‰èƒ½åŠ›     |
| âœ… æ— ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆç±»ç»„ä»¶é‚£å¥—ï¼‰    | æ²¡æœ‰ `componentDidMount`ï¼Œç”¨ `useEffect` æ›¿ä»£            |
| âœ… å¯ç»„åˆæ€§å¼º             | å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ Hook ç»„ç»‡å¤æ‚é€»è¾‘ï¼Œå®ç°â€œé€»è¾‘å¤ç”¨â€                       |
| âœ… æ›´æ˜“è¯»ã€æ˜“æµ‹            | å‡½æ•°æœ¬èº«æ— å‰¯ä½œç”¨ã€æ— éšè—çŠ¶æ€ï¼Œç»“æ„æ‰å¹³ï¼Œä¾¿äºæµ‹è¯•å’Œè°ƒè¯•                        |
| âœ… æ›´é€‚åˆæ€§èƒ½ä¼˜åŒ–           | ä¸ `React.memo`ã€`useMemo`ã€`useCallback` ç­‰ä¼˜åŒ–æ–¹å¼å¤©ç„¶é€‚é…   |
| âœ… ä¸ React çš„æœªæ¥ç‰¹æ€§å…¼å®¹æ€§å¥½ | å¦‚ Concurrent Modeã€Server Componentsã€React Forget ç­‰ |
### 2.3 ç‰¹æ€§å»¶ä¼¸è§£æ
1. æ˜¯çº¯å‡½æ•°ï¼Œä½†ä¸æ˜¯â€œçº¯ç²¹çš„çº¯å‡½æ•°â€
- ç»„ä»¶å‡½æ•°å¯ä»¥åŒ…å«å‰¯ä½œç”¨ï¼ˆåœ¨ useEffect ä¸­ï¼‰ï¼Œä¹Ÿå¯ä»¥æ“ä½œå¤–éƒ¨çŠ¶æ€
- ä½†å®ƒçš„â€œæ¸²æŸ“è¡Œä¸ºâ€æ˜¯çº¯å‡½æ•° â€”â€” è¾“å…¥ props â†’ è¾“å‡º UI
2. æ¯æ¬¡æ¸²æŸ“å°±æ˜¯ä¸€æ¬¡â€œå‡½æ•°æ‰§è¡Œâ€
- å‡½æ•°ç»„ä»¶æ²¡æœ‰â€œå®ä¾‹â€ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯é‡æ–°æ‰§è¡Œç»„ä»¶å‡½æ•°
- Hook çŠ¶æ€ç”± React æ¡†æ¶åœ¨å†…éƒ¨é€šè¿‡è°ƒç”¨é¡ºåºå…³è”ç®¡ç†
- æ‰€ä»¥ä¸èƒ½åœ¨æ¡ä»¶ä¸­è°ƒç”¨ Hookï¼ˆRules of Hooksï¼‰
3. å’Œ Hook æ·±åº¦ç»‘å®š
- å‡½æ•°ç»„ä»¶çš„èƒ½åŠ›ä¸»è¦æ¥è‡ª Hooks
- Hook æ˜¯è®©å‡½æ•°ç»„ä»¶â€œæœ‰çŠ¶æ€â€çš„æ¡¥æ¢ï¼ˆä¹‹å‰å‡½æ•°ç»„ä»¶æ˜¯æ— çŠ¶æ€ç»„ä»¶ï¼‰
### 2.4 hookè§„åˆ™
1. åªåœ¨æœ€é¡¶å±‚è°ƒç”¨ Hook
- ä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hooks
2. åªåœ¨å‡½æ•°ç»„ä»¶æˆ–è‡ªå®šä¹‰ Hook ä¸­è°ƒç”¨ Hook
- ä¸è¦åœ¨æ™®é€šå‡½æ•°ã€classã€äº‹ä»¶å›è°ƒä¸­è°ƒç”¨ Hook

---

## 3. reactç±»ç»„ä»¶çš„state
### 3.1 ä¸€å¥è¯è§£é‡Š
åœ¨ React ç±»ç»„ä»¶ä¸­ï¼Œstate æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºç»„ä»¶å½“å‰çš„çŠ¶æ€ï¼Œé€šè¿‡ this.setState() æ–¹æ³•æ›´æ–°ï¼Œæ›´æ–°ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“
### 3.2 stateæ˜¯ä»€ä¹ˆï¼Ÿ
- æ˜¯ç»„ä»¶å†…éƒ¨çš„ç§æœ‰æ•°æ®
- å’Œ props ä¸åŒï¼Œprops æ˜¯å¤–éƒ¨ä¼ å…¥ï¼Œstate æ˜¯ç»„ä»¶è‡ªå·±ç®¡ç†
- åœ¨ç±»ç»„ä»¶ä¸­ï¼Œå¿…é¡»é€šè¿‡ this.state è®¿é—®
### 3.3 setStateæ˜¯å¦‚ä½•å·¥ä½œçš„
- æ˜¯å¼‚æ­¥æ›´æ–°ï¼ˆå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œå¯èƒ½ä¼šåˆå¹¶å¤šæ¬¡è°ƒç”¨ï¼‰
- ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼ˆrender å‡½æ•°å†æ¬¡æ‰§è¡Œï¼‰
- ä½¿ç”¨å¯¹è±¡æˆ–å‡½æ•°å½¢å¼
### 3.4 setStateçš„æ‰¹å¤„ç†è¡Œä¸º
- åœ¨ React åˆæˆäº‹ä»¶ã€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æ˜¯æ‰¹é‡æ›´æ–°çš„ï¼ˆå¼‚æ­¥åˆå¹¶ï¼‰
- åœ¨ setTimeoutã€åŸç”Ÿäº‹ä»¶ã€Promise.thenä¸­å¯èƒ½æ˜¯åŒæ­¥çš„
- React 18 å¼€å§‹ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸­éƒ½å¯ç”¨è‡ªåŠ¨æ‰¹å¤„ç†
### 3.5 ä¾‹å­
1. åˆæˆäº‹ä»¶ä¸­ setState æ˜¯æ‰¹é‡å¼‚æ­¥çš„
```js
class App extends React.Component {
  state = { count: 0 };

  handleClick = () => {
    this.setState({ count: this.state.count + 1 });
    this.setState({ count: this.state.count + 1 });
    console.log('after setState:', this.state.count);
  };

  render() {
    console.log('render:', this.state.count);
    return <button onClick={this.handleClick}>Click</button>;
  }
}
```
- ä¸¤æ¬¡ setState è¢« æ‰¹å¤„ç†åˆå¹¶ä¸ºä¸€æ¬¡
- this.state åœ¨ console.log æ—¶æ²¡æœ‰ç«‹å³æ›´æ–°
- åªæœ‰åœ¨äº‹ä»¶å¤„ç†å‡½æ•°é€€å‡ºåï¼ŒReact å†ç»Ÿä¸€æ‰§è¡Œ render
2. setTimeout ä¸­ setState æ˜¯åŒæ­¥æ‰§è¡Œçš„
```js
class App extends React.Component {
  state = { count: 0 };

  componentDidMount() {
    setTimeout(() => {
      this.setState({ count: this.state.count + 1 });
      this.setState({ count: this.state.count + 1 });
      console.log('after setState (timeout):', this.state.count);
    }, 0);
  }

  render() {
    console.log('render:', this.state.count);
    return <div>Count: {this.state.count}</div>;
  }
}
```
- åœ¨ setTimeout ä¸­ï¼Œæ¯æ¬¡ setState ç«‹å³è§¦å‘ render
- ä¸¤æ¬¡ render è¢«æ‰§è¡Œäº†
- console.log ä¸­ this.state.count === 2ï¼Œè¯´æ˜ä¸¤æ¬¡éƒ½ç”Ÿæ•ˆäº†
3. åŸç”Ÿ DOM äº‹ä»¶ä¸­ setState ä¹Ÿæ˜¯åŒæ­¥æ‰§è¡Œ
```js
componentDidMount() {
  document.getElementById('btn').addEventListener('click', () => {
    this.setState({ count: this.state.count + 1 });
    this.setState({ count: this.state.count + 1 });
    console.log('native event count:', this.state.count);
  });
}
```
### 3.6ä¾‹å­
| åœºæ™¯                        | React 17 é»˜è®¤è¡Œä¸º | React 18 é»˜è®¤è¡Œä¸º |
| ------------------------- | ------------- | ------------- |
| React åˆæˆäº‹ä»¶                | âœ… æ‰¹å¤„ç†         | âœ… æ‰¹å¤„ç†         |
| ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ componentDidMountï¼‰ | âœ… æ‰¹å¤„ç†         | âœ… æ‰¹å¤„ç†         |
| setTimeout / Promise å›è°ƒ   | âŒ ä¸æ‰¹å¤„ç†ï¼ˆåŒæ­¥ï¼‰    | âœ… è‡ªåŠ¨æ‰¹å¤„ç†ï¼ˆéœ€å¯ç”¨ï¼‰  |
| åŸç”Ÿ DOM äº‹ä»¶                 | âŒ ä¸æ‰¹å¤„ç†ï¼ˆåŒæ­¥ï¼‰    | âœ… è‡ªåŠ¨æ‰¹å¤„ç†ï¼ˆéœ€å¯ç”¨ï¼‰  |

---

## 4. reactçš„åº•å±‚æ¸²æŸ“åŸç†
### 4.1 ä¸€å¥è¯æ€»ç»“
æ„å»º Fiber æ ‘ã€è°ƒåº¦æ›´æ–°ã€ç”Ÿæˆ Virtual DOMã€Diff æ¯”è¾ƒã€æäº¤çœŸå® DOM æ“ä½œã€‚
### 4.2 æ€»ä½“æµç¨‹æ€»è§ˆ
ã€æ›´æ–°è§¦å‘ã€‘â†’ã€Render Phaseï¼ˆæ„å»º Fiber æ ‘ï¼‰ã€‘â†’ã€Commit Phaseï¼ˆæ‰§è¡Œ DOM æ›´æ–°ï¼‰ã€‘
### 4.3 è¯¦ç»†é˜¶æ®µæ‹†è§£
1. æ›´æ–°è§¦å‘
- æ¯”å¦‚ setStateã€useState æ›´æ–°ã€props å˜åŒ–ã€forceUpdat
- React ä¼šå°†æ›´æ–°ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå¹¶é€šè¿‡è°ƒåº¦å™¨è°ƒåº¦
2. Render Phaseï¼ˆæ¸²æŸ“é˜¶æ®µï¼‰
è¿™ä¸€é˜¶æ®µæ˜¯çº¯è®¡ç®—é˜¶æ®µï¼Œä¼šæ„å»ºæ–°çš„ Fiber æ ‘ï¼Œä¸æ¶‰åŠçœŸå® DOM æ“ä½œ
- ä»æ ¹èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œâ€œå·¥ä½œå•å…ƒâ€
- æ¯ä¸€ä¸ªç»„ä»¶ä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ Fiber èŠ‚ç‚¹
- Fiber æ˜¯ React å†…éƒ¨ç»´æŠ¤çš„å·¥ä½œå•å…ƒå¯¹è±¡ï¼ŒåŒ…æ‹¬ç»„ä»¶çŠ¶æ€ã€propsã€effect ç­‰
- é€’å½’æ„å»ºå­ Fiber èŠ‚ç‚¹ï¼ˆç±»ä¼¼äºéå†ç»„ä»¶æ ‘ï¼‰
- å¯¹æ¯”æ—§çš„ Fiber æ ‘ï¼ˆå³ä¸Šä¸€æ¬¡ renderï¼‰ä»¥æ‰¾å‡ºå˜åŒ–
- æ ‡è®°æ¯ä¸ªèŠ‚ç‚¹éœ€è¦æ‰§è¡Œçš„ DOM æ“ä½œï¼ˆPlacementã€Updateã€Deletion ç­‰ï¼‰
- è¿™ä¸ªé˜¶æ®µæ˜¯å¯ä»¥è¢«ä¸­æ–­çš„ï¼ˆå¯ä¸­æ–­æ¸²æŸ“ï¼‰
3. Commit Phaseï¼ˆæäº¤é˜¶æ®µï¼‰
çœŸæ­£è¿›è¡Œ DOM æ“ä½œçš„é˜¶æ®µï¼Œä¸èƒ½è¢«æ‰“æ–­
- éå†å˜åŒ–çš„ Fiber èŠ‚ç‚¹
- æ‰§è¡Œå¯¹åº”çš„ DOM æ“ä½œï¼ˆæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰
- è§¦å‘ç”Ÿå‘½å‘¨æœŸ/å‰¯ä½œç”¨å‡½æ•°
 - ç±»ç»„ä»¶çš„ componentDidMountã€componentDidUpdate
 - å‡½æ•°ç»„ä»¶çš„ useEffectã€useLayoutEffect
- æ›´æ–° refs
4. Repaintï¼ˆæµè§ˆå™¨é‡ç»˜ï¼‰
- React å®Œæˆ DOM æ›´æ–°åï¼Œäº¤ç»™æµè§ˆå™¨æ‰§è¡Œé‡ç»˜
- React æœ¬èº«ä¸ç®¡å…·ä½“çš„æ¸²æŸ“ç»“æœï¼Œå®ƒåªå…³å¿ƒ DOM ç»“æ„
### 4.4 Fiber æ˜¯ä»€ä¹ˆ
| ç‰¹æ€§           | è¯´æ˜                                                                    |
| ------------ | --------------------------------------------------------------------- |
| Fiber æ˜¯ä»€ä¹ˆï¼Ÿ   | React ç”¨äºè¡¨ç¤ºç»„ä»¶çŠ¶æ€çš„æ•°æ®ç»“æ„ï¼ˆJS å¯¹è±¡ï¼Œæ›¿ä»£åŸæ¥çš„ Virtual DOM èŠ‚ç‚¹ï¼‰                       |
| æœ‰å“ªäº›å­—æ®µï¼Ÿ       | `type`, `props`, `stateNode`, `child`, `sibling`, `return`, `flags` ç­‰ |
| ä¸ºä»€ä¹ˆè®¾è®¡ Fiberï¼Ÿ | è§£å†³æ—§ç‰ˆ Virtual DOM æ— æ³•ä¸­æ–­ã€å›é€€çš„é—®é¢˜ï¼Œæ”¯æŒå¼‚æ­¥æ¸²æŸ“ã€ä¼˜å…ˆçº§æ§åˆ¶                              |
| å…·å¤‡ä»€ä¹ˆèƒ½åŠ›ï¼Ÿ      | å¯ä¸­æ–­ã€å¯æ¢å¤ã€å¯ä¼˜å…ˆçº§è°ƒåº¦ã€ç»“æ„æ›´çµæ´»                                                  |
### 4.5 æ›´æ–°è°ƒåº¦ä¸ä¼˜å…ˆçº§æœºåˆ¶
- React å†…éƒ¨æœ‰è°ƒåº¦å™¨ï¼ˆschedulerï¼‰ï¼Œç”¨äºæ ¹æ®ä»»åŠ¡çš„â€œä¼˜å…ˆçº§â€æ‰§è¡Œæ›´æ–°
- æ¯”å¦‚ï¼š
  - ç”¨æˆ·è¾“å…¥ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
  - æ•°æ®è¯·æ±‚ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
  - useDeferredValueã€startTransitionï¼ˆä½ä¼˜å…ˆçº§ï¼‰
### 4.6 æ•´ä¸ªæµç¨‹å›¾ï¼ˆæ–‡å­—ç‰ˆï¼‰
```text
ç”¨æˆ·äº¤äº’ / setState
     â†“
è°ƒåº¦ä»»åŠ¡ï¼ˆSchedulerï¼‰
     â†“
Render Phaseï¼ˆæ„å»ºæ–° Fiber æ ‘ï¼‰
     â†“
Diff ä¸æ—§ Fiber æ ‘
     â†“
æ ‡è®°å˜åŒ–ï¼ˆflagsï¼‰
     â†“
Commit Phaseï¼ˆçœŸå® DOM æ“ä½œ + å‰¯ä½œç”¨ï¼‰
     â†“
æµè§ˆå™¨ç»˜åˆ¶
```
---

## 5. react fiber
### 5.1 æ€»ç»“
React Fiber æ˜¯ React 16 å¼•å…¥çš„æ–°æ¶æ„ï¼Œæ˜¯ä¸€ç§å¯ä¸­æ–­ã€å¯æ¢å¤ã€å…·å¤‡ä¼˜å…ˆçº§çš„ç»„ä»¶æ¸²æŸ“æœºåˆ¶ï¼Œç”¨æ¥æ›¿ä»£åŸå…ˆåŒæ­¥é€’å½’çš„ Virtual DOM Diff å®ç°ï¼Œæ˜¯ React å®ç°å¼‚æ­¥æ¸²æŸ“å’Œå¹¶å‘æ›´æ–°çš„åŸºç¡€
### 5.2 Fiber æ˜¯ä»€ä¹ˆ
- React å†…éƒ¨ç»´æŠ¤çš„ä¸€ç§ æ•°æ®ç»“æ„
- å®ƒä»£è¡¨ UI ä¸­çš„æ¯ä¸€ä¸ªç»„ä»¶ã€DOM èŠ‚ç‚¹æˆ–æ–‡æœ¬èŠ‚ç‚¹
- æ¯ä¸€ä¸ª Fiber æ˜¯ä¸€ä¸ª JS å¯¹è±¡ï¼Œå«åšâ€œFiber èŠ‚ç‚¹â€
### 5.3 Fiberè§£å†³äº†ä»€ä¹ˆé—®é¢˜
- æ›´æ–°æ˜¯åŒæ­¥ã€é€’å½’ã€ä¸å¯ä¸­æ–­çš„
- å¤§å‹ç»„ä»¶æ ‘ä¼šå¯¼è‡´é•¿æ—¶é—´é˜»å¡ä¸»çº¿ç¨‹ï¼ˆæ¯”å¦‚é«˜å¸§åŠ¨ç”»å¡é¡¿ï¼‰
- æ— æ³•ä¼˜é›…æ”¯æŒå¼‚æ­¥ä»»åŠ¡ã€ç”¨æˆ·æ‰“æ–­ã€ä»»åŠ¡ä¼˜å…ˆçº§ç­‰
### 5.4 Fiberçš„ç›®æ ‡
| ç›®æ ‡          | è§£é‡Š                                      |
| ----------- | --------------------------------------- |
| **å¯ä¸­æ–­æ¸²æŸ“**   | å¯ä»¥å°†æ¸²æŸ“ä»»åŠ¡æ‹†æˆå°å—ï¼Œæµè§ˆå™¨ç©ºé—²æ—¶ç»§ç»­å¤„ç†ï¼ˆé¿å…å¡é¡¿ï¼‰            |
| **ä»»åŠ¡ä¼˜å…ˆçº§è°ƒåº¦** | æ¯”å¦‚ç”¨æˆ·è¾“å…¥ä¼˜å…ˆæ¸²æŸ“ï¼Œä½ä¼˜å…ˆçº§æ•°æ®å»¶è¿Ÿæ¸²æŸ“                   |
| **å¹¶å‘æ¸²æŸ“æ”¯æŒ**  | æ”¯æŒ `startTransition`ã€`Suspense` ç­‰å¼‚æ­¥æ¸²æŸ“ç‰¹æ€§ |
| **æ›´ç»†ç²’åº¦çš„æ§åˆ¶** | æ¯ä¸ªç»„ä»¶æ›´æ–°éƒ½èƒ½ç²¾ç¡®è¿½è¸ªå’Œæ ‡è®°çŠ¶æ€å˜åŒ–                     |
### 5.5 Fiber çš„â€œåŒç¼“å†²æœºåˆ¶â€
- æ¯æ¬¡æ¸²æŸ“æ—¶ï¼ŒReact ä¼š
 - ä¿ç•™ä¸€ä»½æ—§çš„ Fiber æ ‘ï¼ˆcurrentï¼‰
 - æ„å»ºä¸€ä»½æ–°çš„ Fiber æ ‘ï¼ˆworkInProgressï¼‰
 - åœ¨ Commit é˜¶æ®µå®Œæˆåï¼Œå°†æ–°æ ‘è®¾ä¸º current

---

## 6. reactçš„ä»»åŠ¡è°ƒåº¦æœºåˆ¶
### 6.1 æ€»ç»“
Reactçš„ä»»åŠ¡è°ƒåº¦æœºåˆ¶åŸºäº Scheduler è°ƒåº¦å™¨ï¼ˆå†…éƒ¨å®ç°ç±»ä¼¼ä»»åŠ¡é˜Ÿåˆ— + ä¼˜å…ˆçº§ç®¡ç† + æ—¶é—´åˆ‡ç‰‡ï¼‰æ¥å®ç°ä¸­æ–­ã€æ¢å¤å’Œå¤šä¼˜å…ˆçº§ä»»åŠ¡æ§åˆ¶ï¼Œæ˜¯ Fiber æ¶æ„å®ç°å¼‚æ­¥å¯ä¸­æ–­æ¸²æŸ“çš„åŸºç¡€
### 6.2 ä¸ºä»€ä¹ˆéœ€è¦ä»»åŠ¡è°ƒåº¦æœºåˆ¶
åœ¨ React 16 ä¹‹å‰ï¼Œæ›´æ–°æ˜¯åŒæ­¥é€’å½’æ‰§è¡Œçš„ï¼š
- ä¸€æ—¦å¼€å§‹æ¸²æŸ“ï¼Œå¿…é¡»ä¸€è·¯æ¸²æŸ“åˆ°åº•ï¼Œæ— æ³•è¢«æ‰“æ–­
- å¤§å‹ç»„ä»¶æ ‘æ›´æ–°ä¼šé•¿æ—¶é—´é˜»å¡ä¸»çº¿ç¨‹ï¼Œé€ æˆå¡é¡¿ï¼Œä¸¥é‡å½±å“ç”¨æˆ·äº¤äº’
- æ— æ³•åŒºåˆ†ä»»åŠ¡ä¼˜å…ˆçº§ï¼ŒUIå“åº”ä¸å¤Ÿçµæ•
### 6.3 React çš„è°ƒåº¦æœºåˆ¶ç›®æ ‡
| ç›®æ ‡      | è§£é‡Š                          |
| ------- | --------------------------- |
| â¸ å¯ä¸­æ–­   | æ¸²æŸ“è¿‡ç¨‹ä¸­å¯ä»¥æš‚åœï¼Œè®©å‡ºä¸»çº¿ç¨‹ï¼ˆå“åº”ç”¨æˆ·äº‹ä»¶ç­‰ï¼‰    |
| ğŸ” å¯æ¢å¤  | ä¸­æ–­åèƒ½ä»æ–­ç‚¹ç»§ç»­ï¼Œä¸éœ€è¦é‡å¤´å¼€å§‹           |
| â³ ä¼˜å…ˆçº§è°ƒåº¦ | ç”¨æˆ·è¾“å…¥/åŠ¨ç”» â†’ é«˜ä¼˜å…ˆçº§ï¼›æ•°æ®åŠ è½½ â†’ ä½ä¼˜å…ˆçº§  |
| â± æ—¶é—´åˆ‡ç‰‡  | é™å®šä»»åŠ¡æ¯ä¸€å¸§æ‰§è¡Œæ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´å°±ä¸­æ–­ï¼Œç­‰ä¸‹ä¸€å¸§å†ç»§ç»­ |
### 6.4 React è°ƒåº¦å™¨æ˜¯å¦‚ä½•å®ç°çš„
- æ˜¯ React å†…éƒ¨çš„è°ƒåº¦å¼•æ“
- ç»´æŠ¤ä¸€ä¸ªâ€œä»»åŠ¡ä¼˜å…ˆé˜Ÿåˆ—â€
- æ¯ä¸ªä»»åŠ¡éƒ½æœ‰
 - callback
 - priorityLevel
 - startTime
 - expirationTime
### 6.5 ä¼˜å…ˆçº§åˆ†ç±»
| ä¼˜å…ˆçº§             | å¯¹åº”åœºæ™¯               | å¤±æ•ˆæ—¶é—´ï¼ˆmsï¼‰ |
| --------------- | ------------------ | -------- |
| `Immediate`     | `flushSync()` å¼ºåˆ¶åŒæ­¥ | -1       |
| `User-blocking` | ç”¨æˆ·è¾“å…¥ï¼ˆæ‹–æ‹½ã€é”®ç›˜ã€é¼ æ ‡ï¼‰     | 250      |
| `Normal`        | é»˜è®¤å¼‚æ­¥ä»»åŠ¡             | 5000     |
| `Low`           | åå°æ›´æ–°ï¼Œå¦‚æ—¥å¿—è®°å½•         | 10000+   |
| `Idle`          | ä¸ç´§æ€¥ï¼Œå¦‚é¢„åŠ è½½ã€ç¦»å±æ¸²æŸ“      | æ— é™       |
### 6.6 æ—¶é—´åˆ‡ç‰‡æœºåˆ¶ï¼ˆTime Slicingï¼‰
- React æ¯å¸§æœ€å¤šåªå ç”¨ 5ms çš„è®¡ç®—æ—¶é—´
- ä½¿ç”¨ requestIdleCallbackï¼ˆæˆ–å†…éƒ¨å®ç°å¦‚ MessageChannelï¼‰æ£€æµ‹æ˜¯å¦è¶…æ—¶
- å¦‚æœä»»åŠ¡è¶…æ—¶ï¼ŒReactä¼šä¸­æ–­æ¸²æŸ“ï¼Œç­‰ä¸‹ä¸€å¸§ç»§ç»­æ„å»ºFiberæ ‘
### 6.7 æ¸²æŸ“è¿‡ç¨‹å¦‚ä½•è¢«è°ƒåº¦
React çš„æ¸²æŸ“åˆ†ä¸º
1. Render Phaseï¼ˆå¯ä¸­æ–­ï¼‰ï¼š
  - æ„å»ºæ–°çš„ Fiber æ ‘
  - æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªâ€œå·¥ä½œå•å…ƒâ€
  - React ä¼šæ ¹æ®æ—¶é—´é¢„ç®—ï¼ˆæ¯”å¦‚ 5msï¼‰å¤„ç†ä¸€éƒ¨åˆ†èŠ‚ç‚¹
  - å¦‚æœè¶…æ—¶ï¼Œå°±æš‚åœï¼Œç¨åç»§ç»­ 
2. Commit Phaseï¼ˆä¸å¯ä¸­æ–­ï¼‰ï¼š
  - ä¸€æ—¦æäº¤å¼€å§‹ï¼Œå¿…é¡»åŒæ­¥æ‰§è¡Œ
  - ä¿®æ”¹ DOMã€æ‰§è¡Œå‰¯ä½œç”¨ï¼ˆuseEffectï¼‰ç­‰
### 6.8 è°ƒåº¦ç³»ç»Ÿåœ¨ä»€ä¹ˆåœºæ™¯ç”Ÿæ•ˆ
| åœºæ™¯                                | æ˜¯å¦å—è°ƒåº¦æ§åˆ¶ | ä¼˜å…ˆçº§ç®¡ç† |
| --------------------------------- | ------- | ----- |
| `setState`ï¼ˆåŒæ­¥ï¼‰                    | âœ…       | âœ…     |
| `useTransition`ã€`startTransition` | âœ…       | âœ…     |
| `flushSync()`                     | âœ…       | âœ…     |
| `useDeferredValue`                | âœ…       | âœ…     |
| æ™®é€šçš„ `setTimeout`                  | âŒ       | âŒ     |
| åŸç”Ÿäº‹ä»¶å¤„ç†                            | âŒ       | âŒ     |

---

## 7. Reactå¸¸ç”¨çš„Hooks
### 7.1 æ€»è§ˆ
| Hook åç§°               | ç”¨é€”æ¦‚è¿°                    | é€‚ç”¨åœºæ™¯ç¤ºä¾‹                        |
| --------------------- | ----------------------- | ----------------------------- |
| `useState`            | å®šä¹‰æœ¬åœ°çŠ¶æ€                  | è®¡æ•°å™¨ã€è¡¨å•è¾“å…¥ã€UI çŠ¶æ€ï¼ˆå¼€å…³ã€åŠ è½½ç­‰ï¼‰        |
| `useEffect`           | å‰¯ä½œç”¨å¤„ç†ï¼ˆå¦‚è¯·æ±‚ã€è®¢é˜…ã€DOM æ“ä½œï¼‰    | å¼‚æ­¥è¯·æ±‚ã€äº‹ä»¶ç›‘å¬ã€æ•°æ®åŒæ­¥ã€æ¸…ç†é€»è¾‘           |
| `useRef`              | è·å– DOM å¼•ç”¨ã€æŒä¹…åŒ–å˜é‡         | æ“ä½œ inputã€canvasï¼Œä¿å­˜ä¸Šä¸€æ¬¡çš„å€¼ç­‰      |
| `useMemo`             | ç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—           | è®¡ç®—å¼€é”€å¤§çš„å‡½æ•°ã€ä¾èµ–å˜åŒ–çš„å€¼               |
| `useCallback`         | ç¼“å­˜å‡½æ•°å¼•ç”¨ï¼Œé¿å…å­ç»„ä»¶ä¸å¿…è¦æ¸²æŸ“       | ä¼ é€’å‡½æ•° props æ—¶ä¸ React.memo æ­é…ä½¿ç”¨ |
| `useContext`          | è·å–ä¸Šä¸‹æ–‡ä¸­çš„å€¼                | è·¨å±‚ç»„ä»¶é€šä¿¡ï¼Œå¦‚ä¸»é¢˜ã€è¯­è¨€ã€ç”¨æˆ·ä¿¡æ¯            |
| `useReducer`          | çŠ¶æ€ç®¡ç†ï¼Œé€‚åˆå¤æ‚çŠ¶æ€ç»“æ„           | Redux æ›¿ä»£ï¼Œç®¡ç†å¯¹è±¡å‹ state æˆ–å¤šçŠ¶æ€è”åŠ¨   |
| `useLayoutEffect`     | å’Œ `useEffect` ç±»ä¼¼ï¼Œä½†åŒæ­¥è§¦å‘  | DOM æ›´æ–°å‰å¼ºåˆ¶è¯»å– DOM ä¿¡æ¯ï¼ˆå¦‚å°ºå¯¸ã€ä½ç½®ï¼‰    |
| `useImperativeHandle` | ä¸ `forwardRef` æ­é…æš´éœ²å®ä¾‹æ–¹æ³• | è‡ªå®šä¹‰ç»„ä»¶å¯¹å¤–æš´éœ²æ–¹æ³•ï¼ˆå¦‚ `focus()`ï¼‰      |
| `useTransition`       | å¯ç”¨å¹¶å‘æ¨¡å¼ä¸­çš„ä½ä¼˜å…ˆçº§æ›´æ–°          | æœç´¢è¾“å…¥ã€é˜²æŠ–æ›´æ–°å¤§æ•°æ®åˆ—è¡¨                |
| `useDeferredValue`    | å»¶è¿ŸæŸäº›å€¼çš„æ›´æ–°ï¼Œæå‡å“åº”é€Ÿåº¦         | é¡µé¢æµç•…æ€§ä¼˜åŒ–ï¼Œå¦‚æœç´¢ç»“æœå»¶è¿Ÿæ›´æ–°             |
| `useId`               | ç”Ÿæˆå”¯ä¸€ IDï¼ˆReact 18 å¼•å…¥ï¼‰    | SSR ä¸­ç”Ÿæˆç¨³å®š idï¼Œç”¨äºæ— éšœç¢å±æ€§å…³è”ç­‰       |
### 7.2 è¯¦ç»†è¯´æ˜
1. useState
```js
const [count, setCount] = useState(0);
```
- å®šä¹‰ç»„ä»¶å†…çš„æœ¬åœ°çŠ¶æ€
- å¤šæ¬¡è°ƒç”¨å¯ç®¡ç†å¤šä¸ª state
- å¼‚æ­¥æ›´æ–°ï¼Œå»ºè®®ç”¨å‡½æ•°å¼ setCount(prev => prev + 1)
2. useEffect
```js
useEffect(() => {
  fetchData();
  return () => cleanup(); // æ¸…ç†å‰¯ä½œç”¨
}, [dep]);
```
- æ›¿ä»£ componentDidMountã€componentDidUpdateã€componentWillUnmount
- æ¯æ¬¡ä¾èµ–å˜åŒ–æ—¶è¿è¡Œ
- æ¸…ç†é€»è¾‘å†™åœ¨ return é‡Œ
3. useRef
```js
const inputRef = useRef(null);
<input ref={inputRef} />
```
- è·å– DOM å…ƒç´ 
- å­˜å‚¨åœ¨æ•´ä¸ªç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­éƒ½ä¸ä¼šå˜åŒ–çš„â€œå¯å˜å€¼
4. useMemo
```js
const expensiveValue = useMemo(() => compute(a, b), [a, b]);
```
- é¿å…æ¯æ¬¡ render éƒ½é‡æ–°æ‰§è¡Œå¼€é”€å¤§çš„å‡½æ•°
- åªæœ‰ä¾èµ–å˜æ›´æ—¶æ‰ä¼šé‡æ–°è®¡ç®—
5. useCallback
```js
const handleClick = useCallback(() => doSomething(), [deps]);
```
- è¿”å›ä¸€ä¸ªç¨³å®šå¼•ç”¨çš„å‡½æ•°ï¼Œé¿å…ä¼ ç»™å­ç»„ä»¶åå¯¼è‡´ä¸å¿…è¦çš„ re-render
- ä¸ React.memo é…åˆä½¿ç”¨æ•ˆæœæœ€ä½³
6. useContext
```js
const theme = useContext(ThemeContext);
```
- è·¨ç»„ä»¶å±‚çº§è·å– context çš„å€¼
- ä¸å†éœ€è¦åµŒå¥— <Consumer>
7. useReducer
```js
const [state, dispatch] = useReducer(reducer, initialState);
```
- ç±»ä¼¼ Redux æ€è·¯
- çŠ¶æ€ç»“æ„å¤æ‚æˆ–æœ‰å¤šä¸ªçŠ¶æ€è”åŠ¨æ—¶æ›´æ¸…æ™°
8. useTransition
```js
const [isPending, startTransition] = useTransition();
startTransition(() => {
  setValue(newValue); // ä½ä¼˜å…ˆçº§æ›´æ–°
});
```
- æ§åˆ¶å“ªäº›æ›´æ–°æ˜¯â€œä½ä¼˜å…ˆçº§â€çš„
- æ¯”å¦‚è¾“å…¥æ¡†å†…å®¹ç«‹å³æ›´æ–°ï¼Œæ•°æ®åˆ—è¡¨ç¨åæ›´æ–°ï¼Œæå‡äº¤äº’ä½“éªŒ
- 

--- 

## 8. useEffectçš„åº•å±‚åŸç†
### 8.1 ä¸€å¥è¯æ€»ç»“
useEffect çš„åº•å±‚å®ç°æ˜¯åŸºäº Fiber æ¶æ„ä¸­çš„ effect list æœºåˆ¶ï¼ŒReact åœ¨ commit é˜¶æ®µç»Ÿä¸€éå† fiber èŠ‚ç‚¹ æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼ˆeffect hooksï¼‰ï¼Œå¹¶åœ¨åˆé€‚çš„æ—¶æœºè¿›è¡Œæ¸…ç†å’Œé‡æ–°æ³¨å†Œ
### 8.2 åº•å±‚æœºåˆ¶æ‹†è§£
React ä¼šåœ¨ Fiber æ¶æ„ä¸­ç»´æŠ¤ä¸€ä»½ã€Œeffect listã€ï¼Œæ¯ä¸ª fiber èŠ‚ç‚¹è®°å½•å®ƒåœ¨å½“å‰æ›´æ–°ä¸­äº§ç”Ÿçš„å‰¯ä½œç”¨ï¼ˆeffectï¼‰ï¼Œè¿™äº›å‰¯ä½œç”¨ä¼šåœ¨ commit é˜¶æ®µç»Ÿä¸€æ‰§è¡Œ
1. render é˜¶æ®µ
- useEffect ä¼šåœ¨æ‰§è¡Œæ—¶
  - åˆ›å»ºä¸€ä¸ª Hook å¯¹è±¡ï¼ˆå†…éƒ¨ç»“æ„å¦‚ { tag, create, destroy, deps }ï¼‰
  - å°†å…¶æŒ‚åˆ°å½“å‰ fiber çš„ updateQueue ä¸Š
  - ä¸ä¼šæ‰§è¡Œ effectï¼ˆä»…è®°å½•ï¼ï¼‰
2. commit é˜¶æ®µï¼ˆDOM æ›´æ–°å®Œæ¯•åï¼‰
  - React éå†æ‰€æœ‰ fiberï¼Œæ”¶é›†éœ€è¦æ‰§è¡Œå‰¯ä½œç”¨çš„ hook
  - åˆ¤æ–­ä¾èµ–æ˜¯å¦å˜åŒ–ï¼ˆdepsChanged()ï¼‰
  - å¦‚æœå˜åŒ–
    - å…ˆæ‰§è¡Œä¸Šä¸€æ¬¡çš„æ¸…ç†å‡½æ•°ï¼ˆdestroyï¼‰
    - ç„¶åæ‰§è¡Œæœ¬æ¬¡çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆcreateï¼‰ï¼Œå¹¶è®°å½•è¿”å›å€¼ä½œä¸ºä¸‹ä¸€æ¬¡çš„ destroy
### 8.3 ç”Ÿå‘½å‘¨æœŸæ¨¡æ‹Ÿå›¾
| ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ                | å‡½æ•°ç»„ä»¶ + useEffect ç­‰æ•ˆ                        |
| ---------------------- | ------------------------------------------ |
| `componentDidMount`    | `useEffect(() => {}, [])`                  |
| `componentDidUpdate`   | `useEffect(() => {}, [deps])`              |
| `componentWillUnmount` | `useEffect(() => { return () => {} }, [])` |
### 8.4 useEffect ä¸ºä»€ä¹ˆå¼‚æ­¥ï¼ˆå»¶åï¼‰æ‰§è¡Œ
- å®ƒä¸ä¼šé˜»å¡ DOM æ¸²æŸ“
- é¿å…é˜»å¡ç»˜åˆ¶å¸§ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
- æ‰€ä»¥åœ¨ commit phase ä¹‹åï¼Œæµè§ˆå™¨ç»˜åˆ¶ä¹‹å‰ æ‰æ‰§è¡Œ
- ä¹Ÿå› æ­¤ä½ åœ¨ useEffect ä¸­è¯»å†™ DOM æ—¶å¯èƒ½çœ‹åˆ°çš„æ˜¯â€œæ—§çš„å¸ƒå±€â€
### 8.5 useLayoutEffect ä¸ useEffect åŒºåˆ«ï¼ˆåº•å±‚è§†è§’ï¼‰
| å¯¹æ¯”é¡¹    | `useEffect`         | `useLayoutEffect`    |
| ------ | ------------------- | -------------------- |
| æ‰§è¡Œæ—¶æœº   | æµè§ˆå™¨ç»˜åˆ¶ä¹‹å             | åœ¨ DOM æ›´æ–°åã€æµè§ˆå™¨ç»˜åˆ¶å‰ç«‹å³æ‰§è¡Œ |
| æ˜¯å¦é˜»å¡æ¸²æŸ“ | âŒ å¦                 | âœ… æ˜¯                  |
| ä½¿ç”¨åœºæ™¯   | å¼‚æ­¥è¯·æ±‚ã€è®¢é˜…ç­‰å‰¯ä½œç”¨         | DOM è¯»å†™ã€æµ‹é‡ã€å¼ºåˆ¶åŒæ­¥å¸ƒå±€ç­‰    |
| åº•å±‚æ‰§è¡Œæ—¶æœº | commit phase ä¹‹åï¼ˆå¼‚æ­¥ï¼‰ | commit phase ä¹‹åï¼ˆåŒæ­¥ï¼‰  |