# reactç›¸å…³çŸ¥è¯†ç‚¹

## 1. reactç±»ç»„ä»¶å’Œå‡½æ•°ç»„ä»¶çš„åŒºåˆ«
### 1.1 å¯¹æ¯”æ€»è§ˆ
| ç»´åº¦        | ç±»ç»„ä»¶ï¼ˆClass Componentï¼‰                | å‡½æ•°ç»„ä»¶ï¼ˆFunction Componentï¼‰           |
| --------- | ----------------------------------- | ---------------------------------- |
| å®šä¹‰æ–¹å¼      | ä½¿ç”¨ `class`ï¼Œç»§æ‰¿è‡ª `React.Component`    | ä½¿ç”¨æ™®é€šçš„ JavaScript å‡½æ•°                |
| çŠ¶æ€ç®¡ç†      | ä½¿ç”¨ `this.state` å’Œ `this.setState()` | ä½¿ç”¨ `useState()` ç­‰ Hook             |
| ç”Ÿå‘½å‘¨æœŸ      | ä½¿ç”¨ç±»ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆå¦‚ `componentDidMount`ï¼‰    | ä½¿ç”¨ `useEffect()` æ›¿ä»£                |
| `this` é—®é¢˜ | `this` éœ€è¦ç»‘å®šï¼ˆå¦‚æ„é€ å‡½æ•°ä¸­ `.bind(this)`)   | æ— éœ€ `this`ï¼Œç›´æ¥è®¿é—® propsã€state         |
| å¯è¯»æ€§/ç®€æ´æ€§   | ç›¸å¯¹ç¹çï¼Œæœ‰å†—ä½™ä»£ç                           | ç®€æ´ã€å‡½æ•°å¼ç¼–ç¨‹é£æ ¼                         |
| Hook ä½¿ç”¨   | âŒ ä¸æ”¯æŒ                               | âœ… æ”¯æŒæ‰€æœ‰ React Hook                  |
| æ€§èƒ½ï¼ˆå°å·®å¼‚ï¼‰   | å·®åˆ«å¾ˆå°ï¼Œä¸»è¦å–å†³äºå†™æ³•                        | åŒä¸Šï¼›å‡½æ•°ç»„ä»¶å¯èƒ½æ›´æ˜“ä¼˜åŒ–ï¼ˆé…åˆ memo/useCallbackï¼‰ |
| ä»£ç å¤ç”¨      | HOCã€render props æ–¹æ¡ˆ                 | å¯ä½¿ç”¨è‡ªå®šä¹‰ Hookï¼Œå®ç°æ›´ä¼˜é›…çš„é€»è¾‘å¤ç”¨             |
| æ˜¯å¦æ¨è      | React 16.8 åä¸æ¨èæ–°å¢ä½¿ç”¨                 | âœ… å®˜æ–¹æ¨èé¦–é€‰æ–¹å¼                         |
### 1.2 ç”Ÿå‘½å‘¨æœŸå¯¹æ¯”
| ç”Ÿå‘½å‘¨æœŸè¡Œä¸º                | ç±»ç»„ä»¶æ–¹æ³•                    | å‡½æ•°ç»„ä»¶ä¸­çš„å†™æ³•ï¼ˆHookï¼‰                                |
| --------------------- | ------------------------ | --------------------------------------------- |
| æŒ‚è½½                    | `componentDidMount()`    | `useEffect(() => { ... }, [])`                |
| æ›´æ–°                    | `componentDidUpdate()`   | `useEffect(() => { ... }, [dep])`             |
| å¸è½½                    | `componentWillUnmount()` | `useEffect(() => { return () => {...} }, [])` |
| shouldComponentUpdate | å¯æ‰‹åŠ¨æ§åˆ¶æ€§èƒ½ä¼˜åŒ–                | `React.memo` + `useMemo/useCallback`          |
### 1.3 æ€»ç»“
å‡½æ•°ç»„ä»¶ + Hooks èƒ½å®ç°ç±»ç»„ä»¶æ— æ³•ä¼˜é›…å®ç°çš„é€»è¾‘å¤ç”¨ã€çŠ¶æ€éš”ç¦»å’Œç»„åˆèƒ½åŠ›ï¼Œå…·æœ‰æ›´é«˜çš„è¡¨è¾¾åŠ›ã€å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§
### 1.4 å…¸å‹åœºæ™¯
1. é€»è¾‘å¤ç”¨
ç±»ç»„ä»¶ä¸­æƒ³å¤ç”¨é€»è¾‘ï¼Œåªèƒ½ç”¨é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰æˆ– render props
```js
// render propsï¼šä¼šäº§ç”Ÿç»„ä»¶åµŒå¥—åœ°ç‹±
<DataFetcher render={(data) => <Component data={data} />} />
```
```js
const data = useDataFetcher(url); // é€»è¾‘å¤ç”¨åƒè°ƒç”¨å‡½æ•°ä¸€æ ·è‡ªç„¶
```
2. é€»è¾‘åˆ†æ•£éš¾ç®¡ç†
ç±»ç»„ä»¶ä¸­ï¼Œä¸€ä¸ªå‰¯ä½œç”¨é€»è¾‘ï¼ˆå¦‚è®¢é˜… WebSocketï¼‰å¾€å¾€æ‹†æ•£åœ¨å¤šä¸ªç”Ÿå‘½å‘¨æœŸä¸­ï¼š
```js
componentDidMount() {
  socket.subscribe();
}
componentDidUpdate() {
  if (someConditionChanged) socket.resubscribe();
}
componentWillUnmount() {
  socket.unsubscribe();
}
```
```js
useEffect(() => {
  socket.subscribe();
  return () => socket.unsubscribe();
}, [someCondition]);
```
3. åŠ¨æ€ Hook ç»„åˆ
ç±»ç»„ä»¶é‡Œæ— æ³•æŒ‰æ¡ä»¶å¼•å…¥ä¸€æ®µçŠ¶æ€é€»è¾‘ï¼Œåªèƒ½æå‰å†™å¥½æ‰€æœ‰é€»è¾‘
```js
if (isEditMode) {
  useEditableLogic();
} else {
  useReadonlyLogic();
}
```
4. ä½¿ç”¨å¤šä¸ªçŠ¶æ€é€»è¾‘æ—¶çš„éš”ç¦»æ€§å’Œå¯æµ‹è¯•æ€§
å‡½æ•°ç»„ä»¶é€šè¿‡å¤šä¸ª useState/useReducer å¯ä»¥æŠŠé€»è¾‘æ‹†å¾—å¾ˆå¹²å‡€ï¼š
```js
const [list, setList] = useListData();
const [searchTerm, setSearchTerm] = useSearch();
const [selected, setSelected] = useSelectedItem();
```
- æ¯ä¸ªçŠ¶æ€é€»è¾‘éƒ½å¯ä»¥å°è£…æˆç‹¬ç«‹çš„è‡ªå®šä¹‰ Hookï¼Œå¤©ç„¶è§£è€¦ã€æ˜“æµ‹è¯•ã€æ˜“é‡ç”¨
- ç±»ç»„ä»¶ä¼šæŠŠè¿™äº›æ··åœ¨ this.state ä¸­ï¼Œéš¾ä»¥æ‹†åˆ†é€»è¾‘ã€‚
### 1.5 æ€§èƒ½ä¼˜åŒ–æ›´æ¸…æ–°
- ğŸ‘ é€»è¾‘æ›´ç»†ç²’åº¦ã€é€æ˜ï¼šçŠ¶æ€æ˜¯æ˜¾å¼çš„ã€Hook æ˜¯å‡½æ•°ï¼Œèƒ½æ˜ç¡®è¿½è¸ªæ¯æ®µé€»è¾‘
- ğŸ”§ ä¼˜åŒ–æ‰‹æ®µç»„åˆçµæ´»ï¼šå¦‚ useMemoã€useCallbackã€React.memo é…åˆä½¿ç”¨ï¼Œç²’åº¦ç²¾å‡†
- ğŸ§± ç»„ä»¶æ˜¯çº¯å‡½æ•°ï¼ˆæ— å‰¯ä½œç”¨ï¼‰æ›´åˆ©äºä¼˜åŒ–ï¼Œä¾‹å¦‚ memoizationã€æƒ°æ€§æ¸²æŸ“ã€é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“
#### ç±»ç»„ä»¶å¦‚ä½•åšæ€§èƒ½ä¼˜åŒ–
1. ä½¿ç”¨ PureComponent
```js
class MyComponent extends React.PureComponent {
  render() {
    return <div>{this.props.value}</div>;
  }
}
```
- è‡ªåŠ¨è¿›è¡Œæµ…æ¯”è¾ƒï¼ˆprops å’Œ stateï¼‰
- ä½†ä»…æµ…æ¯”è¾ƒï¼Œå¼•ç”¨ç±»å‹å˜æ›´ï¼ˆå¦‚æ•°ç»„ã€å¯¹è±¡ï¼‰å®¹æ˜“è§¦å‘è¯¯æ›´æ–°æˆ–è¯¯è·³è¿‡
2. ä½¿ç”¨ shouldComponentUpdate æ‰‹åŠ¨æ§åˆ¶æ›´æ–°
```js
class MyComponent extends React.Component {
  shouldComponentUpdate(nextProps, nextState) {
    return nextProps.value !== this.props.value;
  }
}
```
- ç²¾ç»†æ§åˆ¶æ›´æ–°é€»è¾‘
- å¯è¯»æ€§å·®ã€æ˜“é”™ï¼›å¤šä¸ª props æ—¶é€»è¾‘åºæ‚ï¼Œä¸åˆ©äºç»´æŠ¤
3. ä½¿ç”¨ä¸å¯å˜æ•°æ®ç»“æ„ï¼ˆé…åˆ Reduxã€Immutable.jsï¼‰
- é¿å…å¼•ç”¨åœ°å€ä¸å˜å¯¼è‡´ä¸æ›´æ–°
- å®é™…æ•ˆæœä¸å¦‚ Hook ç›´è§‚
4. æ€»ç»“ç±»ç»„ä»¶ç—›ç‚¹
- æ€§èƒ½ä¼˜åŒ–â€œéšè—â€åœ¨ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œä¸é€æ˜
- æ˜“é—æ¼ shouldComponentUpdateï¼Œå¯¼è‡´å…¨é‡é‡æ¸²æŸ“
- å¤šä¸ªçŠ¶æ€ã€å¤æ‚ä¾èµ–ä¸‹ï¼Œä¸æ˜“å®šä½é—®é¢˜ç‚¹
#### å‡½æ•°å¼ç»„ä»¶è¿›è¡Œæ€§èƒ½ä¼˜åŒ–
1. React.memo(Component)
åŠŸèƒ½ï¼šå¯¹ç»„ä»¶è¿›è¡Œæµ…æ¯”è¾ƒï¼ˆObject.isï¼‰ï¼Œé¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“ï¼ˆç­‰ä»·äº PureComponentï¼‰
```js
const MyComponent = React.memo(function MyComponent({ value }) {
  return <div>{value}</div>;
});
```
æ¨èä½¿ç”¨åœ¨çº¯æ˜¾ç¤ºå‹ç»„ä»¶æˆ– props ä¸ç»å¸¸å˜çš„ç»„ä»¶ä¸­
2. useMemo()
åŠŸèƒ½ï¼šç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—
```js
const expensiveValue = useMemo(() => computeExpensive(a, b), [a, b]);
```
ç”¨äºæ€§èƒ½æ•æ„Ÿçš„è®¡ç®—é€»è¾‘ï¼ˆå¦‚æ’åºã€è¿‡æ»¤ã€å¤§æ•°æ®æ¸²æŸ“ï¼‰
3. useCallback()
åŠŸèƒ½ï¼šç¼“å­˜å‡½æ•°å¼•ç”¨ï¼Œé˜²æ­¢å­ç»„ä»¶å› å‡½æ•°å˜åŒ–è€Œé‡å¤æ¸²æŸ“ã€‚
```js
const handleClick = useCallback(() => {
  console.log('clicked');
}, []);
```
ç”¨äºå°†å›è°ƒä¼ å…¥ memo åŒ–å­ç»„ä»¶æ—¶ï¼Œä¿æŒå¼•ç”¨ç¨³
4. useTransition()ã€useDeferredValue()
åŠŸèƒ½ï¼šå¼‚æ­¥ UI æ›´æ–°ã€å»¶è¿Ÿæ¸²æŸ“ï¼Œæå‡æµç•…åº¦
```js
const deferredValue = useDeferredValue(searchTerm);
```
#### æ€»ç»“å¯¹æ¯”
| ä¼˜åŒ–ç­–ç•¥          | ç±»ç»„ä»¶                     | å‡½æ•°ç»„ä»¶                              |
| ------------- | ----------------------- | --------------------------------- |
| æµ…æ¯”è¾ƒä¼˜åŒ–         | `PureComponent`         | `React.memo()`                    |
| æ‰‹åŠ¨æ›´æ–°æ§åˆ¶        | `shouldComponentUpdate` | `React.memo()` + props æ§åˆ¶         |
| å‡½æ•°ç¼“å­˜          | éœ€è¦æ‰‹åŠ¨ bind æˆ–å®šä¹‰å‡½æ•°         | âœ… `useCallback()`                 |
| è®¡ç®—ç¼“å­˜          | æ—                        | âœ… `useMemo()`                     |
| å¼‚æ­¥æ¸²æŸ“/å»¶è¿Ÿæ›´æ–°     | æ—                        | âœ… `useTransition()` ç­‰ React 18 ç‰¹æ€§ |
| ç”Ÿå‘½å‘¨æœŸä¼˜åŒ–ï¼ˆå‰¯ä½œç”¨åˆå¹¶ï¼‰ | æ‹†åœ¨å¤šä¸ªç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­             | âœ… `useEffect()` é›†ä¸­ç®¡ç†å‰¯ä½œç”¨           |
| æ€§èƒ½åˆ†æä¸å®šä½       | éš¾ä»¥ç²¾å‡†å®šä½ã€åµŒå¥—é€»è¾‘å¤æ‚           | âœ… é€»è¾‘åˆ†æ˜ï¼Œæ˜“æ’æ¡©ä¸ç›‘æ§                     |
#### æœ€ä½³å®è·µ
- é»˜è®¤ä½¿ç”¨å‡½æ•°ç»„ä»¶ï¼Œé…åˆ React.memo å’Œ useCallback æ˜¯æœ€ç¨³å¦¥çš„åšæ³•
- çŠ¶æ€æ‹†åˆ†æˆå¤šä¸ª useState / useReducerï¼Œé€»è¾‘åˆ†ç¦»æ›´åˆ©äºä¼˜åŒ–
- ç”¨ useMemo ç¼“å­˜é‡è®¡ç®—æ•°æ®ï¼Œæ¯”å¦‚ç­›é€‰ã€æ’åºã€è½¬æ¢
- å­ç»„ä»¶ä¸è¦ä¼ é€’æ–°å»ºçš„åŒ¿åå‡½æ•°ï¼ˆå®¹æ˜“ç ´å memoï¼‰
- å¦‚æœå­ç»„ä»¶ props å¾ˆå¤æ‚ï¼Œè€ƒè™‘æ‹†åˆ†æˆæ›´å°çš„ memo åŒ–ç»„ä»¶

---

## 2. reactå‡½æ•°ç»„ä»¶æœ‰ä»€ä¹ˆç‰¹æ€§
### 2.1 ä¸€å¥è¯é‡ç‚¹
React å‡½æ•°ç»„ä»¶æ˜¯çº¯å‡½æ•°å¼å£°æ˜ UI çš„ç»„ä»¶ï¼Œå¤©ç„¶æ”¯æŒ Hooksï¼Œç”¨æ›´ç®€æ´ã€ç»„åˆåŒ–çš„æ–¹å¼æ„å»ºç»„ä»¶é€»è¾‘ï¼Œæ˜¯ç°ä»£ React çš„æ ¸å¿ƒç»„ä»¶æ¨¡å‹
### 2.2 å‡½æ•°ç»„ä»¶çš„æ ¸å¿ƒç‰¹æ€§
| ç‰¹æ€§                  | è¯´æ˜                                                 |
| ------------------- | -------------------------------------------------- |
| âœ… æœ¬è´¨æ˜¯ä¸€ä¸ª JS å‡½æ•°       | ä»¥å‡½æ•°å½¢å¼å®šä¹‰ï¼Œå‚æ•°æ˜¯ `props`ï¼Œè¿”å›å€¼æ˜¯ JSXï¼ˆå³ Virtual DOMï¼‰        |
| âœ… æ—  `this`          | ä¸éœ€è¦ç»‘å®š `this`ï¼Œæ— å®ä¾‹ï¼Œè®¿é—®çŠ¶æ€å’Œæ–¹æ³•æ›´æ¸…æ™°                        |
| âœ… æ”¯æŒ React Hooks    | å¯ä»¥ä½¿ç”¨ `useState`ã€`useEffect` ç­‰ Hook æ·»åŠ çŠ¶æ€ã€å‰¯ä½œç”¨ç­‰èƒ½åŠ›     |
| âœ… æ— ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ï¼ˆç±»ç»„ä»¶é‚£å¥—ï¼‰    | æ²¡æœ‰ `componentDidMount`ï¼Œç”¨ `useEffect` æ›¿ä»£            |
| âœ… å¯ç»„åˆæ€§å¼º             | å¯ä»¥é€šè¿‡è‡ªå®šä¹‰ Hook ç»„ç»‡å¤æ‚é€»è¾‘ï¼Œå®ç°â€œé€»è¾‘å¤ç”¨â€                       |
| âœ… æ›´æ˜“è¯»ã€æ˜“æµ‹            | å‡½æ•°æœ¬èº«æ— å‰¯ä½œç”¨ã€æ— éšè—çŠ¶æ€ï¼Œç»“æ„æ‰å¹³ï¼Œä¾¿äºæµ‹è¯•å’Œè°ƒè¯•                        |
| âœ… æ›´é€‚åˆæ€§èƒ½ä¼˜åŒ–           | ä¸ `React.memo`ã€`useMemo`ã€`useCallback` ç­‰ä¼˜åŒ–æ–¹å¼å¤©ç„¶é€‚é…   |
| âœ… ä¸ React çš„æœªæ¥ç‰¹æ€§å…¼å®¹æ€§å¥½ | å¦‚ Concurrent Modeã€Server Componentsã€React Forget ç­‰ |
### 2.3 ç‰¹æ€§å»¶ä¼¸è§£æ
1. æ˜¯çº¯å‡½æ•°ï¼Œä½†ä¸æ˜¯â€œçº¯ç²¹çš„çº¯å‡½æ•°â€
- ç»„ä»¶å‡½æ•°å¯ä»¥åŒ…å«å‰¯ä½œç”¨ï¼ˆåœ¨ useEffect ä¸­ï¼‰ï¼Œä¹Ÿå¯ä»¥æ“ä½œå¤–éƒ¨çŠ¶æ€
- ä½†å®ƒçš„â€œæ¸²æŸ“è¡Œä¸ºâ€æ˜¯çº¯å‡½æ•° â€”â€” è¾“å…¥ props â†’ è¾“å‡º UI
2. æ¯æ¬¡æ¸²æŸ“å°±æ˜¯ä¸€æ¬¡â€œå‡½æ•°æ‰§è¡Œâ€
- å‡½æ•°ç»„ä»¶æ²¡æœ‰â€œå®ä¾‹â€ï¼Œæ¯æ¬¡æ¸²æŸ“éƒ½æ˜¯é‡æ–°æ‰§è¡Œç»„ä»¶å‡½æ•°
- Hook çŠ¶æ€ç”± React æ¡†æ¶åœ¨å†…éƒ¨é€šè¿‡è°ƒç”¨é¡ºåºå…³è”ç®¡ç†
- æ‰€ä»¥ä¸èƒ½åœ¨æ¡ä»¶ä¸­è°ƒç”¨ Hookï¼ˆRules of Hooksï¼‰
3. å’Œ Hook æ·±åº¦ç»‘å®š
- å‡½æ•°ç»„ä»¶çš„èƒ½åŠ›ä¸»è¦æ¥è‡ª Hooks
- Hook æ˜¯è®©å‡½æ•°ç»„ä»¶â€œæœ‰çŠ¶æ€â€çš„æ¡¥æ¢ï¼ˆä¹‹å‰å‡½æ•°ç»„ä»¶æ˜¯æ— çŠ¶æ€ç»„ä»¶ï¼‰
### 2.4 hookè§„åˆ™
1. åªåœ¨æœ€é¡¶å±‚è°ƒç”¨ Hook
- ä¸è¦åœ¨å¾ªç¯ã€æ¡ä»¶æˆ–åµŒå¥—å‡½æ•°ä¸­è°ƒç”¨ Hooks
2. åªåœ¨å‡½æ•°ç»„ä»¶æˆ–è‡ªå®šä¹‰ Hook ä¸­è°ƒç”¨ Hook
- ä¸è¦åœ¨æ™®é€šå‡½æ•°ã€classã€äº‹ä»¶å›è°ƒä¸­è°ƒç”¨ Hook

---

## 3. reactç±»ç»„ä»¶çš„state
### 3.1 ä¸€å¥è¯è§£é‡Š
åœ¨ React ç±»ç»„ä»¶ä¸­ï¼Œstate æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¡¨ç¤ºç»„ä»¶å½“å‰çš„çŠ¶æ€ï¼Œé€šè¿‡ this.setState() æ–¹æ³•æ›´æ–°ï¼Œæ›´æ–°ä¼šè§¦å‘ç»„ä»¶é‡æ–°æ¸²æŸ“
### 3.2 stateæ˜¯ä»€ä¹ˆï¼Ÿ
- æ˜¯ç»„ä»¶å†…éƒ¨çš„ç§æœ‰æ•°æ®
- å’Œ props ä¸åŒï¼Œprops æ˜¯å¤–éƒ¨ä¼ å…¥ï¼Œstate æ˜¯ç»„ä»¶è‡ªå·±ç®¡ç†
- åœ¨ç±»ç»„ä»¶ä¸­ï¼Œå¿…é¡»é€šè¿‡ this.state è®¿é—®
### 3.3 setStateæ˜¯å¦‚ä½•å·¥ä½œçš„
- æ˜¯å¼‚æ­¥æ›´æ–°ï¼ˆå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œå¯èƒ½ä¼šåˆå¹¶å¤šæ¬¡è°ƒç”¨ï¼‰
- ä¼šè§¦å‘é‡æ–°æ¸²æŸ“ï¼ˆrender å‡½æ•°å†æ¬¡æ‰§è¡Œï¼‰
- ä½¿ç”¨å¯¹è±¡æˆ–å‡½æ•°å½¢å¼
### 3.4 setStateçš„æ‰¹å¤„ç†è¡Œä¸º
- åœ¨ React åˆæˆäº‹ä»¶ã€ç”Ÿå‘½å‘¨æœŸæ–¹æ³•ä¸­æ˜¯æ‰¹é‡æ›´æ–°çš„ï¼ˆå¼‚æ­¥åˆå¹¶ï¼‰
- åœ¨ setTimeoutã€åŸç”Ÿäº‹ä»¶ã€Promise.thenä¸­å¯èƒ½æ˜¯åŒæ­¥çš„
- React 18 å¼€å§‹ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸­éƒ½å¯ç”¨è‡ªåŠ¨æ‰¹å¤„ç†
### 3.5 ä¾‹å­
1. åˆæˆäº‹ä»¶ä¸­ setState æ˜¯æ‰¹é‡å¼‚æ­¥çš„
```js
class App extends React.Component {
  state = { count: 0 };

  handleClick = () => {
    this.setState({ count: this.state.count + 1 });
    this.setState({ count: this.state.count + 1 });
    console.log('after setState:', this.state.count);
  };

  render() {
    console.log('render:', this.state.count);
    return <button onClick={this.handleClick}>Click</button>;
  }
}
```
- ä¸¤æ¬¡ setState è¢« æ‰¹å¤„ç†åˆå¹¶ä¸ºä¸€æ¬¡
- this.state åœ¨ console.log æ—¶æ²¡æœ‰ç«‹å³æ›´æ–°
- åªæœ‰åœ¨äº‹ä»¶å¤„ç†å‡½æ•°é€€å‡ºåï¼ŒReact å†ç»Ÿä¸€æ‰§è¡Œ render
2. setTimeout ä¸­ setState æ˜¯åŒæ­¥æ‰§è¡Œçš„
```js
class App extends React.Component {
  state = { count: 0 };

  componentDidMount() {
    setTimeout(() => {
      this.setState({ count: this.state.count + 1 });
      this.setState({ count: this.state.count + 1 });
      console.log('after setState (timeout):', this.state.count);
    }, 0);
  }

  render() {
    console.log('render:', this.state.count);
    return <div>Count: {this.state.count}</div>;
  }
}
```
- åœ¨ setTimeout ä¸­ï¼Œæ¯æ¬¡ setState ç«‹å³è§¦å‘ render
- ä¸¤æ¬¡ render è¢«æ‰§è¡Œäº†
- console.log ä¸­ this.state.count === 2ï¼Œè¯´æ˜ä¸¤æ¬¡éƒ½ç”Ÿæ•ˆäº†
3. åŸç”Ÿ DOM äº‹ä»¶ä¸­ setState ä¹Ÿæ˜¯åŒæ­¥æ‰§è¡Œ
```js
componentDidMount() {
  document.getElementById('btn').addEventListener('click', () => {
    this.setState({ count: this.state.count + 1 });
    this.setState({ count: this.state.count + 1 });
    console.log('native event count:', this.state.count);
  });
}
```
### 3.6ä¾‹å­
| åœºæ™¯                        | React 17 é»˜è®¤è¡Œä¸º | React 18 é»˜è®¤è¡Œä¸º |
| ------------------------- | ------------- | ------------- |
| React åˆæˆäº‹ä»¶                | âœ… æ‰¹å¤„ç†         | âœ… æ‰¹å¤„ç†         |
| ç”Ÿå‘½å‘¨æœŸï¼ˆå¦‚ componentDidMountï¼‰ | âœ… æ‰¹å¤„ç†         | âœ… æ‰¹å¤„ç†         |
| setTimeout / Promise å›è°ƒ   | âŒ ä¸æ‰¹å¤„ç†ï¼ˆåŒæ­¥ï¼‰    | âœ… è‡ªåŠ¨æ‰¹å¤„ç†ï¼ˆéœ€å¯ç”¨ï¼‰  |
| åŸç”Ÿ DOM äº‹ä»¶                 | âŒ ä¸æ‰¹å¤„ç†ï¼ˆåŒæ­¥ï¼‰    | âœ… è‡ªåŠ¨æ‰¹å¤„ç†ï¼ˆéœ€å¯ç”¨ï¼‰  |

---

## 4. reactçš„åº•å±‚æ¸²æŸ“åŸç†
### 4.1 ä¸€å¥è¯æ€»ç»“
æ„å»º Fiber æ ‘ã€è°ƒåº¦æ›´æ–°ã€ç”Ÿæˆ Virtual DOMã€Diff æ¯”è¾ƒã€æäº¤çœŸå® DOM æ“ä½œã€‚
### 4.2 æ€»ä½“æµç¨‹æ€»è§ˆ
ã€æ›´æ–°è§¦å‘ã€‘â†’ã€Render Phaseï¼ˆæ„å»º Fiber æ ‘ï¼‰ã€‘â†’ã€Commit Phaseï¼ˆæ‰§è¡Œ DOM æ›´æ–°ï¼‰ã€‘
### 4.3 è¯¦ç»†é˜¶æ®µæ‹†è§£
1. æ›´æ–°è§¦å‘
- æ¯”å¦‚ setStateã€useState æ›´æ–°ã€props å˜åŒ–ã€forceUpdat
- React ä¼šå°†æ›´æ–°ä»»åŠ¡æ”¾å…¥ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œå¹¶é€šè¿‡è°ƒåº¦å™¨è°ƒåº¦
2. Render Phaseï¼ˆæ¸²æŸ“é˜¶æ®µï¼‰
è¿™ä¸€é˜¶æ®µæ˜¯çº¯è®¡ç®—é˜¶æ®µï¼Œä¼šæ„å»ºæ–°çš„ Fiber æ ‘ï¼Œä¸æ¶‰åŠçœŸå® DOM æ“ä½œ
- ä»æ ¹èŠ‚ç‚¹å¼€å§‹æ‰§è¡Œâ€œå·¥ä½œå•å…ƒâ€
- æ¯ä¸€ä¸ªç»„ä»¶ä¼šç”Ÿæˆä¸€ä¸ªå¯¹åº”çš„ Fiber èŠ‚ç‚¹
- Fiber æ˜¯ React å†…éƒ¨ç»´æŠ¤çš„å·¥ä½œå•å…ƒå¯¹è±¡ï¼ŒåŒ…æ‹¬ç»„ä»¶çŠ¶æ€ã€propsã€effect ç­‰
- é€’å½’æ„å»ºå­ Fiber èŠ‚ç‚¹ï¼ˆç±»ä¼¼äºéå†ç»„ä»¶æ ‘ï¼‰
- å¯¹æ¯”æ—§çš„ Fiber æ ‘ï¼ˆå³ä¸Šä¸€æ¬¡ renderï¼‰ä»¥æ‰¾å‡ºå˜åŒ–
- æ ‡è®°æ¯ä¸ªèŠ‚ç‚¹éœ€è¦æ‰§è¡Œçš„ DOM æ“ä½œï¼ˆPlacementã€Updateã€Deletion ç­‰ï¼‰
- è¿™ä¸ªé˜¶æ®µæ˜¯å¯ä»¥è¢«ä¸­æ–­çš„ï¼ˆå¯ä¸­æ–­æ¸²æŸ“ï¼‰
3. Commit Phaseï¼ˆæäº¤é˜¶æ®µï¼‰
çœŸæ­£è¿›è¡Œ DOM æ“ä½œçš„é˜¶æ®µï¼Œä¸èƒ½è¢«æ‰“æ–­
- éå†å˜åŒ–çš„ Fiber èŠ‚ç‚¹
- æ‰§è¡Œå¯¹åº”çš„ DOM æ“ä½œï¼ˆæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ï¼‰
- è§¦å‘ç”Ÿå‘½å‘¨æœŸ/å‰¯ä½œç”¨å‡½æ•°
 - ç±»ç»„ä»¶çš„ componentDidMountã€componentDidUpdate
 - å‡½æ•°ç»„ä»¶çš„ useEffectã€useLayoutEffect
- æ›´æ–° refs
4. Repaintï¼ˆæµè§ˆå™¨é‡ç»˜ï¼‰
- React å®Œæˆ DOM æ›´æ–°åï¼Œäº¤ç»™æµè§ˆå™¨æ‰§è¡Œé‡ç»˜
- React æœ¬èº«ä¸ç®¡å…·ä½“çš„æ¸²æŸ“ç»“æœï¼Œå®ƒåªå…³å¿ƒ DOM ç»“æ„
### 4.4 Fiber æ˜¯ä»€ä¹ˆ
| ç‰¹æ€§           | è¯´æ˜                                                                    |
| ------------ | --------------------------------------------------------------------- |
| Fiber æ˜¯ä»€ä¹ˆï¼Ÿ   | React ç”¨äºè¡¨ç¤ºç»„ä»¶çŠ¶æ€çš„æ•°æ®ç»“æ„ï¼ˆJS å¯¹è±¡ï¼Œæ›¿ä»£åŸæ¥çš„ Virtual DOM èŠ‚ç‚¹ï¼‰                       |
| æœ‰å“ªäº›å­—æ®µï¼Ÿ       | `type`, `props`, `stateNode`, `child`, `sibling`, `return`, `flags` ç­‰ |
| ä¸ºä»€ä¹ˆè®¾è®¡ Fiberï¼Ÿ | è§£å†³æ—§ç‰ˆ Virtual DOM æ— æ³•ä¸­æ–­ã€å›é€€çš„é—®é¢˜ï¼Œæ”¯æŒå¼‚æ­¥æ¸²æŸ“ã€ä¼˜å…ˆçº§æ§åˆ¶                              |
| å…·å¤‡ä»€ä¹ˆèƒ½åŠ›ï¼Ÿ      | å¯ä¸­æ–­ã€å¯æ¢å¤ã€å¯ä¼˜å…ˆçº§è°ƒåº¦ã€ç»“æ„æ›´çµæ´»                                                  |
### 4.5 æ›´æ–°è°ƒåº¦ä¸ä¼˜å…ˆçº§æœºåˆ¶
- React å†…éƒ¨æœ‰è°ƒåº¦å™¨ï¼ˆschedulerï¼‰ï¼Œç”¨äºæ ¹æ®ä»»åŠ¡çš„â€œä¼˜å…ˆçº§â€æ‰§è¡Œæ›´æ–°
- æ¯”å¦‚ï¼š
  - ç”¨æˆ·è¾“å…¥ï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰
  - æ•°æ®è¯·æ±‚ï¼ˆä¸­ä¼˜å…ˆçº§ï¼‰
  - useDeferredValueã€startTransitionï¼ˆä½ä¼˜å…ˆçº§ï¼‰
### 4.6 æ•´ä¸ªæµç¨‹å›¾ï¼ˆæ–‡å­—ç‰ˆï¼‰
```text
ç”¨æˆ·äº¤äº’ / setState
     â†“
è°ƒåº¦ä»»åŠ¡ï¼ˆSchedulerï¼‰
     â†“
Render Phaseï¼ˆæ„å»ºæ–° Fiber æ ‘ï¼‰
     â†“
Diff ä¸æ—§ Fiber æ ‘
     â†“
æ ‡è®°å˜åŒ–ï¼ˆflagsï¼‰
     â†“
Commit Phaseï¼ˆçœŸå® DOM æ“ä½œ + å‰¯ä½œç”¨ï¼‰
     â†“
æµè§ˆå™¨ç»˜åˆ¶
```
---

## 5. [react fiber](https://juejin.cn/post/7225957841319379005)
### 5.1 æ€»ç»“
React Fiber æ˜¯ React 16 å¼•å…¥çš„æ–°æ¶æ„ï¼Œæ˜¯ä¸€ç§å¯ä¸­æ–­ã€å¯æ¢å¤ã€å…·å¤‡ä¼˜å…ˆçº§çš„ç»„ä»¶æ¸²æŸ“æœºåˆ¶ï¼Œç”¨æ¥æ›¿ä»£åŸå…ˆåŒæ­¥é€’å½’çš„ Virtual DOM Diff å®ç°ï¼Œæ˜¯ React å®ç°å¼‚æ­¥æ¸²æŸ“å’Œå¹¶å‘æ›´æ–°çš„åŸºç¡€
### 5.2 Fiber æ˜¯ä»€ä¹ˆ
- React å†…éƒ¨ç»´æŠ¤çš„ä¸€ç§ æ•°æ®ç»“æ„
- å®ƒä»£è¡¨ UI ä¸­çš„æ¯ä¸€ä¸ªç»„ä»¶ã€DOM èŠ‚ç‚¹æˆ–æ–‡æœ¬èŠ‚ç‚¹
- æ¯ä¸€ä¸ª Fiber æ˜¯ä¸€ä¸ª JS å¯¹è±¡ï¼Œå«åšâ€œFiber èŠ‚ç‚¹â€
### 5.3 Fiberè§£å†³äº†ä»€ä¹ˆé—®é¢˜
- æ›´æ–°æ˜¯åŒæ­¥ã€é€’å½’ã€ä¸å¯ä¸­æ–­çš„
- å¤§å‹ç»„ä»¶æ ‘ä¼šå¯¼è‡´é•¿æ—¶é—´é˜»å¡ä¸»çº¿ç¨‹ï¼ˆæ¯”å¦‚é«˜å¸§åŠ¨ç”»å¡é¡¿ï¼‰
- æ— æ³•ä¼˜é›…æ”¯æŒå¼‚æ­¥ä»»åŠ¡ã€ç”¨æˆ·æ‰“æ–­ã€ä»»åŠ¡ä¼˜å…ˆçº§ç­‰
### 5.4 Fiberçš„ç›®æ ‡
| ç›®æ ‡          | è§£é‡Š                                      |
| ----------- | --------------------------------------- |
| **å¯ä¸­æ–­æ¸²æŸ“**   | å¯ä»¥å°†æ¸²æŸ“ä»»åŠ¡æ‹†æˆå°å—ï¼Œæµè§ˆå™¨ç©ºé—²æ—¶ç»§ç»­å¤„ç†ï¼ˆé¿å…å¡é¡¿ï¼‰            |
| **ä»»åŠ¡ä¼˜å…ˆçº§è°ƒåº¦** | æ¯”å¦‚ç”¨æˆ·è¾“å…¥ä¼˜å…ˆæ¸²æŸ“ï¼Œä½ä¼˜å…ˆçº§æ•°æ®å»¶è¿Ÿæ¸²æŸ“                   |
| **å¹¶å‘æ¸²æŸ“æ”¯æŒ**  | æ”¯æŒ `startTransition`ã€`Suspense` ç­‰å¼‚æ­¥æ¸²æŸ“ç‰¹æ€§ |
| **æ›´ç»†ç²’åº¦çš„æ§åˆ¶** | æ¯ä¸ªç»„ä»¶æ›´æ–°éƒ½èƒ½ç²¾ç¡®è¿½è¸ªå’Œæ ‡è®°çŠ¶æ€å˜åŒ–                     |
### 5.5 Fiber çš„â€œåŒç¼“å†²æœºåˆ¶â€
- æ¯æ¬¡æ¸²æŸ“æ—¶ï¼ŒReact ä¼š
 - ä¿ç•™ä¸€ä»½æ—§çš„ Fiber æ ‘ï¼ˆcurrentï¼‰
 - æ„å»ºä¸€ä»½æ–°çš„ Fiber æ ‘ï¼ˆworkInProgressï¼‰
 - åœ¨ Commit é˜¶æ®µå®Œæˆåï¼Œå°†æ–°æ ‘è®¾ä¸º current

---

## 6. reactçš„ä»»åŠ¡è°ƒåº¦æœºåˆ¶
### 6.1 æ€»ç»“
Reactçš„ä»»åŠ¡è°ƒåº¦æœºåˆ¶åŸºäº Scheduler è°ƒåº¦å™¨ï¼ˆå†…éƒ¨å®ç°ç±»ä¼¼ä»»åŠ¡é˜Ÿåˆ— + ä¼˜å…ˆçº§ç®¡ç† + æ—¶é—´åˆ‡ç‰‡ï¼‰æ¥å®ç°ä¸­æ–­ã€æ¢å¤å’Œå¤šä¼˜å…ˆçº§ä»»åŠ¡æ§åˆ¶ï¼Œæ˜¯ Fiber æ¶æ„å®ç°å¼‚æ­¥å¯ä¸­æ–­æ¸²æŸ“çš„åŸºç¡€
### 6.2 ä¸ºä»€ä¹ˆéœ€è¦ä»»åŠ¡è°ƒåº¦æœºåˆ¶
åœ¨ React 16 ä¹‹å‰ï¼Œæ›´æ–°æ˜¯åŒæ­¥é€’å½’æ‰§è¡Œçš„ï¼š
- ä¸€æ—¦å¼€å§‹æ¸²æŸ“ï¼Œå¿…é¡»ä¸€è·¯æ¸²æŸ“åˆ°åº•ï¼Œæ— æ³•è¢«æ‰“æ–­
- å¤§å‹ç»„ä»¶æ ‘æ›´æ–°ä¼šé•¿æ—¶é—´é˜»å¡ä¸»çº¿ç¨‹ï¼Œé€ æˆå¡é¡¿ï¼Œä¸¥é‡å½±å“ç”¨æˆ·äº¤äº’
- æ— æ³•åŒºåˆ†ä»»åŠ¡ä¼˜å…ˆçº§ï¼ŒUIå“åº”ä¸å¤Ÿçµæ•
### 6.3 React çš„è°ƒåº¦æœºåˆ¶ç›®æ ‡
| ç›®æ ‡      | è§£é‡Š                          |
| ------- | --------------------------- |
| â¸ å¯ä¸­æ–­   | æ¸²æŸ“è¿‡ç¨‹ä¸­å¯ä»¥æš‚åœï¼Œè®©å‡ºä¸»çº¿ç¨‹ï¼ˆå“åº”ç”¨æˆ·äº‹ä»¶ç­‰ï¼‰    |
| ğŸ” å¯æ¢å¤  | ä¸­æ–­åèƒ½ä»æ–­ç‚¹ç»§ç»­ï¼Œä¸éœ€è¦é‡å¤´å¼€å§‹           |
| â³ ä¼˜å…ˆçº§è°ƒåº¦ | ç”¨æˆ·è¾“å…¥/åŠ¨ç”» â†’ é«˜ä¼˜å…ˆçº§ï¼›æ•°æ®åŠ è½½ â†’ ä½ä¼˜å…ˆçº§  |
| â± æ—¶é—´åˆ‡ç‰‡  | é™å®šä»»åŠ¡æ¯ä¸€å¸§æ‰§è¡Œæ—¶é—´ï¼Œè¶…è¿‡æ—¶é—´å°±ä¸­æ–­ï¼Œç­‰ä¸‹ä¸€å¸§å†ç»§ç»­ |
### 6.4 React è°ƒåº¦å™¨æ˜¯å¦‚ä½•å®ç°çš„
- æ˜¯ React å†…éƒ¨çš„è°ƒåº¦å¼•æ“
- ç»´æŠ¤ä¸€ä¸ªâ€œä»»åŠ¡ä¼˜å…ˆé˜Ÿåˆ—â€
- æ¯ä¸ªä»»åŠ¡éƒ½æœ‰
 - callback
 - priorityLevel
 - startTime
 - expirationTime
### 6.5 ä¼˜å…ˆçº§åˆ†ç±»
| ä¼˜å…ˆçº§             | å¯¹åº”åœºæ™¯               | å¤±æ•ˆæ—¶é—´ï¼ˆmsï¼‰ |
| --------------- | ------------------ | -------- |
| `Immediate`     | `flushSync()` å¼ºåˆ¶åŒæ­¥ | -1       |
| `User-blocking` | ç”¨æˆ·è¾“å…¥ï¼ˆæ‹–æ‹½ã€é”®ç›˜ã€é¼ æ ‡ï¼‰     | 250      |
| `Normal`        | é»˜è®¤å¼‚æ­¥ä»»åŠ¡             | 5000     |
| `Low`           | åå°æ›´æ–°ï¼Œå¦‚æ—¥å¿—è®°å½•         | 10000+   |
| `Idle`          | ä¸ç´§æ€¥ï¼Œå¦‚é¢„åŠ è½½ã€ç¦»å±æ¸²æŸ“      | æ— é™       |
### 6.6 æ—¶é—´åˆ‡ç‰‡æœºåˆ¶ï¼ˆTime Slicingï¼‰
- React æ¯å¸§æœ€å¤šåªå ç”¨ 5ms çš„è®¡ç®—æ—¶é—´
- ä½¿ç”¨ requestIdleCallbackï¼ˆæˆ–å†…éƒ¨å®ç°å¦‚ MessageChannelï¼‰æ£€æµ‹æ˜¯å¦è¶…æ—¶
- å¦‚æœä»»åŠ¡è¶…æ—¶ï¼ŒReactä¼šä¸­æ–­æ¸²æŸ“ï¼Œç­‰ä¸‹ä¸€å¸§ç»§ç»­æ„å»ºFiberæ ‘
### 6.7 æ¸²æŸ“è¿‡ç¨‹å¦‚ä½•è¢«è°ƒåº¦
React çš„æ¸²æŸ“åˆ†ä¸º
1. Render Phaseï¼ˆå¯ä¸­æ–­ï¼‰ï¼š
  - æ„å»ºæ–°çš„ Fiber æ ‘
  - æ¯ä¸ªç»„ä»¶éƒ½æ˜¯ä¸€ä¸ªâ€œå·¥ä½œå•å…ƒâ€
  - React ä¼šæ ¹æ®æ—¶é—´é¢„ç®—ï¼ˆæ¯”å¦‚ 5msï¼‰å¤„ç†ä¸€éƒ¨åˆ†èŠ‚ç‚¹
  - å¦‚æœè¶…æ—¶ï¼Œå°±æš‚åœï¼Œç¨åç»§ç»­ 
2. Commit Phaseï¼ˆä¸å¯ä¸­æ–­ï¼‰ï¼š
  - ä¸€æ—¦æäº¤å¼€å§‹ï¼Œå¿…é¡»åŒæ­¥æ‰§è¡Œ
  - ä¿®æ”¹ DOMã€æ‰§è¡Œå‰¯ä½œç”¨ï¼ˆuseEffectï¼‰ç­‰
### 6.8 è°ƒåº¦ç³»ç»Ÿåœ¨ä»€ä¹ˆåœºæ™¯ç”Ÿæ•ˆ
| åœºæ™¯                                | æ˜¯å¦å—è°ƒåº¦æ§åˆ¶ | ä¼˜å…ˆçº§ç®¡ç† |
| --------------------------------- | ------- | ----- |
| `setState`ï¼ˆåŒæ­¥ï¼‰                    | âœ…       | âœ…     |
| `useTransition`ã€`startTransition` | âœ…       | âœ…     |
| `flushSync()`                     | âœ…       | âœ…     |
| `useDeferredValue`                | âœ…       | âœ…     |
| æ™®é€šçš„ `setTimeout`                  | âŒ       | âŒ     |
| åŸç”Ÿäº‹ä»¶å¤„ç†                            | âŒ       | âŒ     |

---

## 7. Reactå¸¸ç”¨çš„Hooks
### 7.1 æ€»è§ˆ
| Hook åç§°               | ç”¨é€”æ¦‚è¿°                    | é€‚ç”¨åœºæ™¯ç¤ºä¾‹                        |
| --------------------- | ----------------------- | ----------------------------- |
| `useState`            | å®šä¹‰æœ¬åœ°çŠ¶æ€                  | è®¡æ•°å™¨ã€è¡¨å•è¾“å…¥ã€UI çŠ¶æ€ï¼ˆå¼€å…³ã€åŠ è½½ç­‰ï¼‰        |
| `useEffect`           | å‰¯ä½œç”¨å¤„ç†ï¼ˆå¦‚è¯·æ±‚ã€è®¢é˜…ã€DOM æ“ä½œï¼‰    | å¼‚æ­¥è¯·æ±‚ã€äº‹ä»¶ç›‘å¬ã€æ•°æ®åŒæ­¥ã€æ¸…ç†é€»è¾‘           |
| `useRef`              | è·å– DOM å¼•ç”¨ã€æŒä¹…åŒ–å˜é‡         | æ“ä½œ inputã€canvasï¼Œä¿å­˜ä¸Šä¸€æ¬¡çš„å€¼ç­‰      |
| `useMemo`             | ç¼“å­˜è®¡ç®—ç»“æœï¼Œé¿å…é‡å¤è®¡ç®—           | è®¡ç®—å¼€é”€å¤§çš„å‡½æ•°ã€ä¾èµ–å˜åŒ–çš„å€¼               |
| `useCallback`         | ç¼“å­˜å‡½æ•°å¼•ç”¨ï¼Œé¿å…å­ç»„ä»¶ä¸å¿…è¦æ¸²æŸ“       | ä¼ é€’å‡½æ•° props æ—¶ä¸ React.memo æ­é…ä½¿ç”¨ |
| `useContext`          | è·å–ä¸Šä¸‹æ–‡ä¸­çš„å€¼                | è·¨å±‚ç»„ä»¶é€šä¿¡ï¼Œå¦‚ä¸»é¢˜ã€è¯­è¨€ã€ç”¨æˆ·ä¿¡æ¯            |
| `useReducer`          | çŠ¶æ€ç®¡ç†ï¼Œé€‚åˆå¤æ‚çŠ¶æ€ç»“æ„           | Redux æ›¿ä»£ï¼Œç®¡ç†å¯¹è±¡å‹ state æˆ–å¤šçŠ¶æ€è”åŠ¨   |
| `useLayoutEffect`     | å’Œ `useEffect` ç±»ä¼¼ï¼Œä½†åŒæ­¥è§¦å‘  | DOM æ›´æ–°å‰å¼ºåˆ¶è¯»å– DOM ä¿¡æ¯ï¼ˆå¦‚å°ºå¯¸ã€ä½ç½®ï¼‰    |
| `useImperativeHandle` | ä¸ `forwardRef` æ­é…æš´éœ²å®ä¾‹æ–¹æ³• | è‡ªå®šä¹‰ç»„ä»¶å¯¹å¤–æš´éœ²æ–¹æ³•ï¼ˆå¦‚ `focus()`ï¼‰      |
| `useTransition`       | å¯ç”¨å¹¶å‘æ¨¡å¼ä¸­çš„ä½ä¼˜å…ˆçº§æ›´æ–°          | æœç´¢è¾“å…¥ã€é˜²æŠ–æ›´æ–°å¤§æ•°æ®åˆ—è¡¨                |
| `useDeferredValue`    | å»¶è¿ŸæŸäº›å€¼çš„æ›´æ–°ï¼Œæå‡å“åº”é€Ÿåº¦         | é¡µé¢æµç•…æ€§ä¼˜åŒ–ï¼Œå¦‚æœç´¢ç»“æœå»¶è¿Ÿæ›´æ–°             |
| `useId`               | ç”Ÿæˆå”¯ä¸€ IDï¼ˆReact 18 å¼•å…¥ï¼‰    | SSR ä¸­ç”Ÿæˆç¨³å®š idï¼Œç”¨äºæ— éšœç¢å±æ€§å…³è”ç­‰       |
### 7.2 è¯¦ç»†è¯´æ˜
1. useState
```js
const [count, setCount] = useState(0);
```
- å®šä¹‰ç»„ä»¶å†…çš„æœ¬åœ°çŠ¶æ€
- å¤šæ¬¡è°ƒç”¨å¯ç®¡ç†å¤šä¸ª state
- å¼‚æ­¥æ›´æ–°ï¼Œå»ºè®®ç”¨å‡½æ•°å¼ setCount(prev => prev + 1)
2. useEffect
```js
useEffect(() => {
  fetchData();
  return () => cleanup(); // æ¸…ç†å‰¯ä½œç”¨
}, [dep]);
```
- æ›¿ä»£ componentDidMountã€componentDidUpdateã€componentWillUnmount
- æ¯æ¬¡ä¾èµ–å˜åŒ–æ—¶è¿è¡Œ
- æ¸…ç†é€»è¾‘å†™åœ¨ return é‡Œ
3. useRef
```js
const inputRef = useRef(null);
<input ref={inputRef} />
```
- è·å– DOM å…ƒç´ 
- å­˜å‚¨åœ¨æ•´ä¸ªç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­éƒ½ä¸ä¼šå˜åŒ–çš„â€œå¯å˜å€¼
4. useMemo
```js
const expensiveValue = useMemo(() => compute(a, b), [a, b]);
```
- é¿å…æ¯æ¬¡ render éƒ½é‡æ–°æ‰§è¡Œå¼€é”€å¤§çš„å‡½æ•°
- åªæœ‰ä¾èµ–å˜æ›´æ—¶æ‰ä¼šé‡æ–°è®¡ç®—
5. useCallback
```js
const handleClick = useCallback(() => doSomething(), [deps]);
```
- è¿”å›ä¸€ä¸ªç¨³å®šå¼•ç”¨çš„å‡½æ•°ï¼Œé¿å…ä¼ ç»™å­ç»„ä»¶åå¯¼è‡´ä¸å¿…è¦çš„ re-render
- ä¸ React.memo é…åˆä½¿ç”¨æ•ˆæœæœ€ä½³
6. useContext
```js
const theme = useContext(ThemeContext);
```
- è·¨ç»„ä»¶å±‚çº§è·å– context çš„å€¼
- ä¸å†éœ€è¦åµŒå¥— <Consumer>
7. useReducer
```js
const [state, dispatch] = useReducer(reducer, initialState);
```
- ç±»ä¼¼ Redux æ€è·¯
- çŠ¶æ€ç»“æ„å¤æ‚æˆ–æœ‰å¤šä¸ªçŠ¶æ€è”åŠ¨æ—¶æ›´æ¸…æ™°
8. useTransition
```js
const [isPending, startTransition] = useTransition();
startTransition(() => {
  setValue(newValue); // ä½ä¼˜å…ˆçº§æ›´æ–°
});
```
- æ§åˆ¶å“ªäº›æ›´æ–°æ˜¯â€œä½ä¼˜å…ˆçº§â€çš„
- æ¯”å¦‚è¾“å…¥æ¡†å†…å®¹ç«‹å³æ›´æ–°ï¼Œæ•°æ®åˆ—è¡¨ç¨åæ›´æ–°ï¼Œæå‡äº¤äº’ä½“éªŒ
- 

--- 

## 8. useEffectçš„åº•å±‚åŸç†
### 8.1 ä¸€å¥è¯æ€»ç»“
useEffect çš„åº•å±‚å®ç°æ˜¯åŸºäº Fiber æ¶æ„ä¸­çš„ effect list æœºåˆ¶ï¼ŒReact åœ¨ commit é˜¶æ®µç»Ÿä¸€éå† fiber èŠ‚ç‚¹ æ‰§è¡Œå‰¯ä½œç”¨å‡½æ•°ï¼ˆeffect hooksï¼‰ï¼Œå¹¶åœ¨åˆé€‚çš„æ—¶æœºè¿›è¡Œæ¸…ç†å’Œé‡æ–°æ³¨å†Œ
### 8.2 åº•å±‚æœºåˆ¶æ‹†è§£
React ä¼šåœ¨ Fiber æ¶æ„ä¸­ç»´æŠ¤ä¸€ä»½ã€Œeffect listã€ï¼Œæ¯ä¸ª fiber èŠ‚ç‚¹è®°å½•å®ƒåœ¨å½“å‰æ›´æ–°ä¸­äº§ç”Ÿçš„å‰¯ä½œç”¨ï¼ˆeffectï¼‰ï¼Œè¿™äº›å‰¯ä½œç”¨ä¼šåœ¨ commit é˜¶æ®µç»Ÿä¸€æ‰§è¡Œ
1. render é˜¶æ®µ
- useEffect ä¼šåœ¨æ‰§è¡Œæ—¶
  - åˆ›å»ºä¸€ä¸ª Hook å¯¹è±¡ï¼ˆå†…éƒ¨ç»“æ„å¦‚ { tag, create, destroy, deps }ï¼‰
  - å°†å…¶æŒ‚åˆ°å½“å‰ fiber çš„ updateQueue ä¸Š
  - ä¸ä¼šæ‰§è¡Œ effectï¼ˆä»…è®°å½•ï¼ï¼‰
2. commit é˜¶æ®µï¼ˆDOM æ›´æ–°å®Œæ¯•åï¼‰
  - React éå†æ‰€æœ‰ fiberï¼Œæ”¶é›†éœ€è¦æ‰§è¡Œå‰¯ä½œç”¨çš„ hook
  - åˆ¤æ–­ä¾èµ–æ˜¯å¦å˜åŒ–ï¼ˆdepsChanged()ï¼‰
  - å¦‚æœå˜åŒ–
    - å…ˆæ‰§è¡Œä¸Šä¸€æ¬¡çš„æ¸…ç†å‡½æ•°ï¼ˆdestroyï¼‰
    - ç„¶åæ‰§è¡Œæœ¬æ¬¡çš„å‰¯ä½œç”¨å‡½æ•°ï¼ˆcreateï¼‰ï¼Œå¹¶è®°å½•è¿”å›å€¼ä½œä¸ºä¸‹ä¸€æ¬¡çš„ destroy
### 8.3 ç”Ÿå‘½å‘¨æœŸæ¨¡æ‹Ÿå›¾
| ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ                | å‡½æ•°ç»„ä»¶ + useEffect ç­‰æ•ˆ                        |
| ---------------------- | ------------------------------------------ |
| `componentDidMount`    | `useEffect(() => {}, [])`                  |
| `componentDidUpdate`   | `useEffect(() => {}, [deps])`              |
| `componentWillUnmount` | `useEffect(() => { return () => {} }, [])` |
### 8.4 useEffect ä¸ºä»€ä¹ˆå¼‚æ­¥ï¼ˆå»¶åï¼‰æ‰§è¡Œ
- å®ƒä¸ä¼šé˜»å¡ DOM æ¸²æŸ“
- é¿å…é˜»å¡ç»˜åˆ¶å¸§ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
- æ‰€ä»¥åœ¨ commit phase ä¹‹åï¼Œæµè§ˆå™¨ç»˜åˆ¶ä¹‹å‰ æ‰æ‰§è¡Œ
- ä¹Ÿå› æ­¤ä½ åœ¨ useEffect ä¸­è¯»å†™ DOM æ—¶å¯èƒ½çœ‹åˆ°çš„æ˜¯â€œæ—§çš„å¸ƒå±€â€
### 8.5 useLayoutEffect ä¸ useEffect åŒºåˆ«ï¼ˆåº•å±‚è§†è§’ï¼‰
| å¯¹æ¯”é¡¹    | `useEffect`         | `useLayoutEffect`    |
| ------ | ------------------- | -------------------- |
| æ‰§è¡Œæ—¶æœº   | æµè§ˆå™¨ç»˜åˆ¶ä¹‹å             | åœ¨ DOM æ›´æ–°åã€æµè§ˆå™¨ç»˜åˆ¶å‰ç«‹å³æ‰§è¡Œ |
| æ˜¯å¦é˜»å¡æ¸²æŸ“ | âŒ å¦                 | âœ… æ˜¯                  |
| ä½¿ç”¨åœºæ™¯   | å¼‚æ­¥è¯·æ±‚ã€è®¢é˜…ç­‰å‰¯ä½œç”¨         | DOM è¯»å†™ã€æµ‹é‡ã€å¼ºåˆ¶åŒæ­¥å¸ƒå±€ç­‰    |
| åº•å±‚æ‰§è¡Œæ—¶æœº | commit phase ä¹‹åï¼ˆå¼‚æ­¥ï¼‰ | commit phase ä¹‹åï¼ˆåŒæ­¥ï¼‰  |

---

## 9. useEffectå’ŒuseLayoutEffectçš„åŒºåˆ«
### 9.1 ä¸€å¥è¯æ€»ç»“
1. useEffect æ˜¯å¼‚æ­¥æ‰§è¡Œçš„å‰¯ä½œç”¨ Hookï¼Œå‘ç”Ÿåœ¨æµè§ˆå™¨ç»˜åˆ¶ä¹‹å
2. useLayoutEffect æ˜¯åŒæ­¥æ‰§è¡Œçš„ï¼Œåœ¨ DOM å˜æ›´ä¹‹åä½†ç»˜åˆ¶ä¹‹å‰æ‰§è¡Œï¼Œé€‚åˆéœ€è¦è¯»å–æˆ–åŒæ­¥æ“ä½œ DOM çš„åœºæ™¯
### 9.2 æ ¸å¿ƒåŒºåˆ«
| å¯¹æ¯”é¡¹                      | `useEffect`                | `useLayoutEffect`   |
| ------------------------ | -------------------------- | ------------------- |
| æ‰§è¡Œæ—¶æœº                     | **DOM æ›´æ–°åï¼Œæµè§ˆå™¨ç»˜åˆ¶å**ï¼ˆå¼‚æ­¥ï¼‰     | **DOM æ›´æ–°åï¼Œç»˜åˆ¶å‰**ï¼ˆåŒæ­¥ï¼‰ |
| æ˜¯å¦é˜»å¡æµè§ˆå™¨ç»˜åˆ¶                | âŒ å¦                        | âœ… æ˜¯                 |
| é€‚åˆåœºæ™¯                     | å¼‚æ­¥è¯·æ±‚ã€è®¢é˜…ã€æ—¥å¿—ã€äº‹ä»¶ç»‘å®š            | è¯»å– DOMã€æµ‹é‡å¸ƒå±€ã€åŒæ­¥ä¿®æ”¹æ ·å¼  |
| æ˜¯å¦æ›¿ä»£ `componentDidMount` | âœ… æ˜¯ï¼ˆåœ¨å‡½æ•°ç»„ä»¶ä¸­ï¼‰                | âœ… æ˜¯ï¼ˆä½†æ›´æ—©æ‰§è¡Œï¼‰          |
| å¯èƒ½å¯¼è‡´é—ªçƒ/æŠ–åŠ¨                | âœ… æœ‰å¯èƒ½ï¼ˆæ ·å¼å˜æ›´æ»åï¼‰              | âŒ ä¸ä¼šï¼ˆåœ¨ç»˜åˆ¶å‰å®Œæˆ DOM æ“ä½œï¼‰ |
| æ˜¯å¦æ¨èä¼˜å…ˆä½¿ç”¨                 | âœ… æ˜¯ï¼Œ90% åœºæ™¯éƒ½æ¨èç”¨ `useEffect` | âŒ ä»…å½“å¿…é¡»åŒæ­¥å¤„ç† DOM æ—¶ä½¿ç”¨  |
### 9.3 æ‰§è¡Œé¡ºåº
```text
render() â†’ commit DOM â†’ 
â†’ useLayoutEffect() æ‰§è¡Œ â†’ æµè§ˆå™¨ç»˜åˆ¶ â†’
â†’ useEffect() æ‰§è¡Œï¼ˆå¼‚æ­¥è°ƒåº¦ï¼‰
```
### 9.4 refè®¿é—®
| Hook              | èƒ½å¦è®¿é—® DOMï¼Ÿ | æ‹¿åˆ°çš„æ˜¯ä¸æ˜¯æœ€æ–° DOMï¼Ÿ   | æ˜¯å¦ä¼šé€ æˆé—ªçƒ/å¸ƒå±€é”™ä¹±ï¼Ÿ | æ¨èç”¨é€”              |
| ----------------- | --------- | --------------- | ------------- | ----------------- |
| `useEffect`       | âœ… å¯ä»¥      | âŒ **ä¸ä¸€å®šæ˜¯æœ€æ–°çš„**   | âœ… **å¯èƒ½é—ªçƒ**    | å¼‚æ­¥å‰¯ä½œç”¨ã€ä¸å…³å¿ƒå¸ƒå±€       |
| `useLayoutEffect` | âœ… å¯ä»¥      | âœ… æ˜¯**å·²æ›´æ–°çš„ DOM** | âŒ ä¸ä¼šé—ªçƒ        | è¯»å–/åŒæ­¥æ“ä½œ DOMã€æ›´ç²¾ç¡®æ§åˆ¶ |

---

## 10. ä¸ºä»€ä¹ˆuseEffectæ— æ³•è·å–æœ€æ–°çš„domå…ƒç´ 
useLayoutEffect å’Œ useEffect éƒ½èƒ½è®¿é—® DOMï¼Œä½†åœ¨è¯»å–å¸ƒå±€ä¿¡æ¯æ—¶éƒ½å¯èƒ½é‡åˆ°æµè§ˆå™¨å°šæœª layout çš„é—®é¢˜ã€‚ä¸åŒçš„æ˜¯ï¼ŒuseLayoutEffect æ‰§è¡Œæ—©äºæµè§ˆå™¨ç»˜åˆ¶ï¼Œå› æ­¤ä½ åœ¨é‡Œé¢æ›´æ”¹æ ·å¼ä¸ä¼šé€ æˆè§†è§‰æŠ–åŠ¨ã€‚è€Œåœ¨ useEffect ä¸­ä¿®æ”¹æ ·å¼ï¼Œç”¨æˆ·å¯èƒ½ä¼šå…ˆçœ‹åˆ°æ—§æ ·å¼ï¼Œé€ æˆâ€œé—ªä¸€ä¸‹â€çš„ä½“éªŒé—®é¢˜
### æ€»ç»“
1. DOM èŠ‚ç‚¹è®¿é—®ï¼šuseLayoutEffect å’Œ useEffect éƒ½èƒ½è®¿é—®
2. DOM å¸ƒå±€ä¿¡æ¯ï¼šä¸¤è€…éƒ½å¯èƒ½éœ€è¦å¼ºåˆ¶è§¦å‘ layout æ‰èƒ½è·å–å‡†ç¡®å€¼
3. DOM æ ·å¼ä¿®æ”¹ï¼šuseLayoutEffect å®‰å…¨ï¼ŒuseEffect å¯èƒ½é—ªçƒ

---

## 11. useRefå’ŒuseStateåº•å±‚åŒºåˆ«
### 11.1 å¿«é€Ÿç»“è®ºå¯¹æ¯”è¡¨
| å¯¹æ¯”ç‚¹                   | `useRef`                                           | `useState`                    |
| --------------------- | -------------------------------------------------- | ----------------------------- |
| **æ•°æ®å­˜å‚¨ä½ç½®**            | ä¿å­˜åœ¨ `fiber.memoizedState` ä¸­ï¼ˆåŒ useStateï¼‰ï¼Œä½†ä¸ä¼šå‚ä¸ diff | åŒä¸Š                            |
| **å€¼æ›´æ–°æ˜¯å¦è§¦å‘ç»„ä»¶æ›´æ–°**       | âŒ ä¸è§¦å‘ç»„ä»¶æ›´æ–°                                          | âœ… ä¼šè§¦å‘ç»„ä»¶é‡æ–° render              |
| **å€¼åœ¨ render ä¸­æ˜¯å¦ä¿æŒä¸å˜** | âœ… æ˜¯åŒä¸€ä¸ª `ref.current` å¯¹è±¡                            | âŒ æ¯æ¬¡ render é‡æ–°æ‹¿åˆå§‹ stateï¼ˆé—­åŒ…é—®é¢˜ï¼‰ |
| **ç”¨é€”**                | å­˜æ”¾**ä¸ä¼šè§¦å‘æ›´æ–°çš„æŒä¹…æ•°æ®**ï¼Œæˆ– DOM å¼•ç”¨                         | å­˜æ”¾**ç”¨äºè§¦å‘ UI æ›´æ–°çš„æ•°æ®**           |
| **React æ˜¯å¦è·Ÿè¸ªå®ƒçš„å˜åŒ–**    | âŒ ä¸è·Ÿè¸ªï¼ˆmutableï¼‰                                     | âœ… ä¼šè·Ÿè¸ªï¼ˆimmutableï¼‰ï¼Œç”¨äºæ¯”è¾ƒæ–°æ—§å€¼      |
| **é€‚åˆå­˜æ”¾çš„æ•°æ®ç±»å‹**         | å®šæ—¶å™¨IDã€åŠ¨ç”»çŠ¶æ€ã€æ»šåŠ¨ä½ç½®ã€DOM å¼•ç”¨ç­‰                            | UI éœ€è¦å“åº”çš„æ•°æ®ï¼Œå¦‚è¾“å…¥æ¡†å†…å®¹ã€tabé€‰ä¸­çŠ¶æ€ç­‰    |
### 11.2 åº•å±‚åŸç†åˆ†æ
#### useState åº•å±‚åŸç†
1. React åœ¨åˆæ¬¡æ¸²æŸ“æ—¶è°ƒç”¨ useState(initialValue)ï¼Œåœ¨ Fiber çš„é“¾è¡¨ä¸­åˆ›å»ºä¸€ä¸ª Hook
```js
hook.memoizedState = initialValue;
```
2. è¿”å›[state, setState]
3. å½“ setState(newValue) è¢«è°ƒç”¨æ—¶
 - React æ¯”è¾ƒæ—§å€¼ä¸æ–°å€¼
 - è‹¥ä¸åŒï¼Œåˆ™è§¦å‘ re-renderï¼›
 - Fiber é‡æ–°æ‰§è¡Œ render é˜¶æ®µï¼Œç”Ÿæˆæ–°çš„ Virtual DOM
 - æœ€ç»ˆ commit é˜¶æ®µæ›´æ–°çœŸå® DOM
#### useRef åº•å±‚åŸç†
1. åˆæ¬¡æ‰§è¡Œ useRef(initialValue)ï¼Œä¹Ÿåˆ›å»ºä¸€ä¸ª Hook
```js
hook.memoizedState = { current: initialValue };
```
2. è¿”å›è¿™ä¸ª { current: ... } å¯¹è±¡ï¼Œæ¯æ¬¡ render éƒ½æ˜¯åŒä¸€ä¸ªå¯¹è±¡
3. å½“ä½ ä¿®æ”¹ ref.currentï¼Œåªæ˜¯æ™®é€šå¯¹è±¡å±æ€§èµ‹å€¼ï¼ŒReact å®Œå…¨ä¸ä¼šå¯Ÿè§‰ï¼Œä¹Ÿä¸ä¼š re-render

---

## 12. setStateçš„é—­åŒ…é™·é˜±
### 12.1 ä»€ä¹ˆæ˜¯é—­åŒ…é™·é˜±
ä½ åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ã€setTimeoutã€å‰¯ä½œç”¨å‡½æ•°ï¼ˆå¦‚ useEffectï¼‰ç­‰å¼‚æ­¥ä»£ç ä¸­è®¿é—®äº†æŸä¸ª state å˜é‡ï¼Œä½†è¿™ä¸ªå˜é‡çš„å€¼å¹¶ä¸æ˜¯ä½ â€œä»¥ä¸ºçš„æœ€æ–°å€¼â€ï¼Œè€Œæ˜¯å®ƒæ‰€å±é‚£æ¬¡ render çš„æ—§å€¼
### 12.2 å…¸å‹ä¾‹å­
```js
function App() {
  const [count, setCount] = useState(0);

  const handleClick = () => {
    setTimeout(() => {
      console.log('count:', count); // âŒ å¯èƒ½ä¸æ˜¯æœ€æ–°å€¼
      setCount(count + 1);          // âŒ å¯èƒ½åŠ çš„æ˜¯æ—§å€¼
    }, 1000);
  };

  return <button onClick={handleClick}>Click me</button>;
}
```
- setTimeout(() => ...) é—­åŒ…ä¸­è®¿é—®çš„ count æ˜¯ å½“å‰ render ä¸­çš„å˜é‡
- å³ä½¿åç»­æœ‰æ–°çš„ renderï¼Œæ—§çš„é—­åŒ…ä¾ç„¶å¼•ç”¨çš„æ˜¯æ—§çš„ count
- æ‰€ä»¥ count + 1 å®é™…æ˜¯åŸºäºæ—§å€¼ï¼ŒåŠ å®Œåä»ç„¶æ˜¯æ—§å€¼ + 1ï¼Œçœ‹ä¼¼ set äº†ï¼Œå®é™…æ²¡å˜
### 12.3 åŸå› è§£é‡Š
| åŸå›               | è§£é‡Š                                            |
| --------------- | --------------------------------------------- |
| å‡½æ•°ç»„ä»¶æ˜¯æ™®é€šå‡½æ•°       | æ¯æ¬¡é‡æ–° render å°±æ˜¯ä¸€æ¬¡æ–°å‡½æ•°æ‰§è¡Œ                         |
| æ¯æ¬¡ render çš„å˜é‡   | éƒ½æ˜¯å½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„å¿«ç…§ï¼Œ**ä¸ä¼šè‡ªåŠ¨å˜æˆâ€œæœ€æ–°çŠ¶æ€â€**                 |
| é—­åŒ…å¼•ç”¨çš„æ˜¯è€å˜é‡       | `setTimeout`ã€äº‹ä»¶å›è°ƒä¸­å¼•ç”¨çš„æ˜¯**ç»‘å®šé—­åŒ…å½“æ—¶çš„å˜é‡å¿«ç…§**         |
| React ä¸å¸®ä½ é­”æ³•æ›´æ–°é—­åŒ… | React ä¸ä¼šè‡ªåŠ¨æ›´æ–°ä½ é—­åŒ…é‡Œçš„ `count`ï¼Œä½ å¾—è‡ªå·±è·å–æœ€æ–°å€¼ï¼ˆå¦‚é€šè¿‡å‡½æ•°å¼æ›´æ–°ï¼‰ |
### 12.4 å¦‚ä½•é¿å…é—­åŒ…é™·é˜±
1. ä½¿ç”¨å‡½æ•°å¼æ›´æ–°
```js
setCount(prev => prev + 1);
```
2. ä½¿ç”¨useRefæŒä¹…ä¿å­˜æœ€æ–°å€¼
```js
const countRef = useRef(count);
useEffect(() => {
  countRef.current = count;
}, [count]);

setTimeout(() => {
  console.log(countRef.current); // âœ… æ°¸è¿œæ˜¯æœ€æ–°çš„
}, 1000);
```

---

## 13. useEffectèƒ½ç›‘å¬useRefçš„å€¼å‘ç”Ÿæ”¹å˜å—
ä¸èƒ½ï¼ŒReact çš„ useEffect æ— æ³•ç›‘å¬ useRef.current çš„å˜åŒ–ï¼ŒuseRef æ˜¯éå“åº”å¼çš„ï¼ŒReact å¹¶ä¸ä¼šè¿½è¸ª ref.current çš„å˜åŒ–ã€‚
### 13.1 è¯¦ç»†è§£é‡Š
useRef çš„æœ¬è´¨
```js
const ref = useRef(0);
```
å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªç¨³å®šçš„å¯¹è±¡
```js
{ current: 0 }
```
è¿™ä¸ªå¯¹è±¡æœ¬èº«åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­æ˜¯æ’å®šçš„ï¼Œåªä¼šåœ¨åˆå§‹ useRef() æ—¶åˆ›å»ºä¸€æ¬¡  
å½“ä½ ä¿®æ”¹
```js
ref.current = 123;
```
---

## 14. useContextè§¦å‘æ›´æ–°çš„æ¡ä»¶
1. ä½¿ç”¨äº† useContext(MyContext)
ç»„ä»¶å¿…é¡»ä¸»åŠ¨è°ƒç”¨ useContext(SomeContext) æ‰ä¼šè®¢é˜…æ›´æ–°
2. ä¸Šå±‚çš„ <Provider> æä¾›çš„ value å¼•ç”¨å‘ç”Ÿå˜åŒ–
```js
<MyContext.Provider value={someObject}>
```
- å¦‚æœ someObject æ˜¯æ–°å¯¹è±¡ï¼Œæˆ–åŸå§‹ç±»å‹æ–°å€¼ â†’ âœ… æ›´æ–°
- å¦‚æœæ˜¯åŒä¸€ä¸ªå¼•ç”¨ â†’ âŒ ä¸æ›´æ–°

---

## 15. reactçš„useRefå’Œvue3çš„refåŒºåˆ«
### 15.1 å¿«é€Ÿå¯¹æ¯”è¡¨
| å¯¹æ¯”ç»´åº¦         | React `useRef`               | Vue 3 `ref`               |
| ------------ | ---------------------------- | ------------------------- |
| **æ˜¯å¦å“åº”å¼**    | âŒ éå“åº”å¼ï¼ˆæ›´åƒâ€œå®¹å™¨â€ï¼‰               | âœ… å“åº”å¼ï¼ˆç”± Proxy åŒ…è£…ï¼Œèƒ½è§¦å‘è§†å›¾æ›´æ–°ï¼‰ |
| **ç”¨é€”æ ¸å¿ƒ**     | æŒä¹…ä¿å­˜ä»»æ„å˜é‡æˆ– DOMï¼Œä¸è§¦å‘æ¸²æŸ“          | åˆ›å»ºå“åº”å¼æ•°æ®ï¼Œè§¦å‘è§†å›¾æ›´æ–°            |
| **å€¼çš„è®¿é—®æ–¹å¼**   | `.current`                   | `.value`                  |
| **æ˜¯å¦è§¦å‘ç»„ä»¶æ›´æ–°** | âŒ ä¿®æ”¹ `.current` ä¸è§¦å‘ç»„ä»¶ render | âœ… ä¿®æ”¹ `.value` ä¼šè§¦å‘å“åº”å¼ä¾èµ–æ›´æ–°  |
| **å†…éƒ¨å®ç°æœºåˆ¶**   | æ™®é€š JS å¯¹è±¡ï¼Œä¸å— React è¿½è¸ª         | Proxy åŒ…è£…çš„å¯¹è±¡ï¼Œå— Vue å“åº”ç³»ç»Ÿè¿½è¸ª  |
| **å…¸å‹ç”¨é€”**     | DOM å¼•ç”¨ã€ä¿å­˜å®šæ—¶å™¨/ä¸­é—´çŠ¶æ€ã€é—­åŒ…æ•°æ®       | å®šä¹‰ç»„ä»¶å†…éƒ¨å“åº”å¼å˜é‡               |

---

## 16. reactç»„ä»¶ä¹‹é—´çš„é€šä¿¡
### 16.1 å¸¸è§çš„æ–¹å¼
| åºå· | é€šä¿¡æ–¹å¼                          | é€‚ç”¨åœºæ™¯                 | æ˜¯å¦æ¨è       |
| -- | ----------------------------- | -------------------- | ---------- |
| 1  | `props` ä¼ é€’                    | çˆ¶ç»„ä»¶ â†’ å­ç»„ä»¶ï¼ˆæœ€åŸºæœ¬ï¼‰       | âœ… å¼ºçƒˆæ¨è     |
| 2  | å›è°ƒå‡½æ•°ä¼ é€’ï¼ˆprops ä¸­ï¼‰               | å­ç»„ä»¶ â†’ çˆ¶ç»„ä»¶            | âœ… æ¨è       |
| 3  | `Context` ä¸Šä¸‹æ–‡                 | å¤šå±‚çº§è·¨ç»„ä»¶ä¼ é€’ï¼Œå…¨å±€é…ç½®ç­‰       | âœ… æ¨è       |
| 4  | `useRef` + `forwardRef`       | çˆ¶ç»„ä»¶ç›´æ¥è®¿é—®å­ç»„ä»¶çš„å†…éƒ¨æ–¹æ³•æˆ– DOM | âœ… æ¨èï¼ˆå¤æ‚åœºæ™¯ï¼‰ |
| 5  | å…¨å±€çŠ¶æ€ç®¡ç†ï¼ˆå¦‚ Reduxã€Zustandã€Jotaiï¼‰ | å¤§å‹é¡¹ç›®ä¸­ç»„ä»¶å…±äº«å¤æ‚çŠ¶æ€        | âœ… æ¨è       |
| 6  | URL å‚æ•°ã€Router çŠ¶æ€              | é¡µé¢è·³è½¬ã€é€šä¿¡ä¾èµ–è·¯ç”±å‚æ•°        | âœ… æ¨è       |
| 7  | è‡ªå®šä¹‰äº‹ä»¶ / EventBus              | è·¨ç»„ä»¶ä¸åµŒå¥—ã€æ¾è€¦åˆé€šä¿¡ï¼ˆä¸æ¨èæ»¥ç”¨ï¼‰  | âš ï¸ ä»…é™æç«¯æƒ…å†µ  |
### 16.2 å…¸å‹ç¤ºä¾‹
1. refé€šä¿¡ï¼ˆçˆ¶æ“ä½œå­ï¼‰
```js
const Child = forwardRef((props, ref) => {
  useImperativeHandle(ref, () => ({
    sayHi: () => alert('hi'),
  }));
  return <div>Child</div>;
});

function Parent() {
  const childRef = useRef();
  return (
    <>
      <Child ref={childRef} />
      <button onClick={() => childRef.current.sayHi()}>Call</button>
    </>
  );
}
```
2. Routerå‚æ•°é€šä¿¡
```js
<Route path="/detail/:id" element={<Detail />} />

function Detail() {
  const { id } = useParams();
  return <p>ID: {id}</p>;
}
```

---

## 17. reactçŠ¶æ€ç®¡ç†çš„å‡ ç§æ–¹å¼
### 17.1 å¸¸è§æ–¹å¼
| çŠ¶æ€ç®¡ç†æ–¹å¼                    | çŠ¶æ€ä½œç”¨åŸŸ     | ç‰¹ç‚¹æ€»ç»“                       | æ˜¯å¦æ¨è                     |
| ------------------------- | --------- | -------------------------- | ------------------------ |
| `useState` / `useReducer` | å•ä¸ªç»„ä»¶å†…éƒ¨    | ç®€å•è½»é‡ã€å±€éƒ¨çŠ¶æ€                  | âœ… æ¨è                     |
| `props + å›è°ƒ`              | çˆ¶å­ç»„ä»¶é—´     | åŸºç¡€å•å‘æ•°æ®æµï¼Œæ˜“ç†è§£                | âœ… æ¨è                     |
| `Context` + `useContext`  | å¤šå±‚åµŒå¥—ç»„ä»¶å…±äº«  | è·¨å±‚ä¼ å€¼ç®€æ´ï¼Œä½†**æ•´ä¸ªä¸Šä¸‹æ–‡æ›´æ–°ä¼šå¼•å‘é‡æ–°æ¸²æŸ“** | âœ… æ¨èï¼ˆæ³¨æ„ä¼˜åŒ–ï¼‰               |
| ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†ï¼ˆRedux ç­‰ï¼‰          | è·¨æ¨¡å—å…¨å±€çŠ¶æ€   | å¼ºä¸€è‡´æ€§ã€å¯è¿½è¸ªè°ƒè¯•ã€æ’ä»¶ç”Ÿæ€å¥½           | âœ… æ¨èï¼ˆä¸­å¤§å‹é¡¹ç›®ï¼‰              |
| è½»é‡çŠ¶æ€åº“ï¼ˆZustandã€Jotaiï¼‰      | çµæ´»ï¼ˆå±€éƒ¨æˆ–å…¨å±€ï¼‰ | API ç®€æ´ã€æ€§èƒ½ä¼˜ç§€ã€Hooks é£æ ¼       | âœ… æ¨è                     |
| URL è·¯ç”±çŠ¶æ€                  | é¡µé¢è·³è½¬ç›¸å…³çŠ¶æ€  | åˆ©äºæ·±é“¾æ¥ã€åˆ·æ–°ä¿ç•™çŠ¶æ€ã€æµè§ˆå™¨å‰è¿›åé€€       | âœ… æ¨èï¼ˆé…åˆ useSearchParamsï¼‰ |
| æœ¬åœ°æŒä¹…åŒ–çŠ¶æ€ï¼ˆlocalStorageï¼‰     | è·¨ä¼šè¯æ•°æ®     | æ•°æ®æŒä¹…åŒ–ï¼Œä½†ä¸å…·å“åº”æ€§               | âœ… å¸¸é…åˆå…¶å®ƒçŠ¶æ€ä½¿ç”¨              |
| æœåŠ¡ç«¯çŠ¶æ€ï¼ˆå¦‚ SWRã€React Queryï¼‰  | å¼‚æ­¥è¿œç¨‹æ•°æ®    | ä¸“é—¨ç®¡ç† API è¯·æ±‚ã€ç¼“å­˜ã€è‡ªåŠ¨é‡è¯•        | âœ… æ¨èï¼ˆè¿œç¨‹æ•°æ®ï¼‰               |

---

## 18. è‡ªå®šä¹‰ Hook çš„è®¾è®¡åŸåˆ™
### 18.1 ä»€ä¹ˆæ˜¯è‡ªå®šä¹‰Hook
è‡ªå®šä¹‰ Hook æ˜¯ä¸€ä¸ªä»¥ use å¼€å¤´çš„å‡½æ•°ï¼Œç”¨äºå°è£…ç»„ä»¶ä¸­å¯å¤ç”¨çš„çŠ¶æ€é€»è¾‘ã€ç”Ÿå‘½å‘¨æœŸå‰¯ä½œç”¨æˆ–äº¤äº’é€»è¾‘ã€‚
```js
function useXXX() {
  // ä½¿ç”¨å…¶ä»– Hookï¼Œæ¯”å¦‚ useStateã€useEffect
  return ...
}
```
### 18.2 è®¾è®¡åŸåˆ™
1. å¿…é¡»ä»¥useå¼€å¤´
- Reactä¼šæ ¹æ®å‡½æ•°åè¯†åˆ«å®ƒæ˜¯ä¸€ä¸ª Hook
- å¦‚æœä¸ä»¥ use å¼€å¤´ï¼Œeslint-plugin-react-hooks ä¼šæŠ¥é”™
- è¿™æ˜¯ React èƒ½æ­£ç¡®è·Ÿè¸ª Hook è°ƒç”¨é¡ºåºçš„å‰æ
2. åªèƒ½åœ¨æœ€å¤–å±‚è°ƒç”¨å…¶ä»– Hook
- è‡ªå®šä¹‰ Hook å†…éƒ¨å¯ä»¥è°ƒç”¨ useStateã€useEffect ç­‰ï¼Œä½†å¿…é¡»åœ¨å‡½æ•°ä½“é¡¶å±‚è°ƒç”¨
- ä¸èƒ½åœ¨ ifã€forã€å›è°ƒä¸­è°ƒç”¨ Hook
- éµå¾ª React Hook çš„â€œè°ƒç”¨é¡ºåºä¸€è‡´â€åŸåˆ™
3. å°è£…é€»è¾‘è€ŒéUI
- è‡ªå®šä¹‰ Hook åº”è¯¥ä¸“æ³¨äºâ€œé€»è¾‘â€ï¼Œè€Œä¸æ˜¯â€œæ¸²æŸ“â€
- ä¸è¦è¿”å› JSXï¼Œè€Œæ˜¯è¿”å›æ•°æ®ã€æ–¹æ³•ã€çŠ¶æ€
4. æ”¯æŒå¯é…ç½®å‚æ•°
- å°†â€œæ˜“å˜éƒ¨åˆ†â€ä½œä¸ºå‚æ•°ä¼ å…¥
### 18.3 è®¾è®¡åŸåˆ™è¡¨æ ¼
| åŸåˆ™                  | æ ¸å¿ƒè§£é‡Š                                         |
| ------------------- | -------------------------------------------- |
| 1ï¸âƒ£ å‘½åä»¥ `use` å¼€å¤´    | éµå¾ª React è§„åˆ™ï¼ŒHook æ£€æµ‹æœºåˆ¶ä¾èµ–äºæ­¤å‘½å                  |
| 2ï¸âƒ£ ä»…åœ¨å‡½æ•°ç»„ä»¶/Hook ä¸­è°ƒç”¨ | é¿å…åœ¨å¾ªç¯ã€æ¡ä»¶ã€æ™®é€šå‡½æ•°ä¸­è°ƒç”¨ï¼Œç¡®ä¿è°ƒç”¨é¡ºåºä¸€è‡´                    |
| 3ï¸âƒ£ å°è£…å•ä¸€èŒè´£          | æ¯ä¸ª Hook åªåšä¸€ä»¶äº‹ï¼Œä¾¿äºç»„åˆä¸æµ‹è¯•                        |
| 4ï¸âƒ£ å‚æ•°æ§åˆ¶ Hook è¡Œä¸º    | å°†â€œå˜åŒ–ç‚¹â€é€šè¿‡å‚æ•°æ³¨å…¥ï¼Œä½¿ Hook æ›´é€šç”¨                      |
| 5ï¸âƒ£ è¿”å›æ˜ç¡® API        | è¿”å›å¯¹è±¡ç»“æ„æ˜ç¡®ï¼ˆå¦‚ `{ data, loading, error }`ï¼‰ï¼Œå¢å¼ºå¯è¯»æ€§ |
| 6ï¸âƒ£ å†…éƒ¨å¯ä½¿ç”¨å…¶å®ƒ Hook    | å…è®¸åµŒå¥—è°ƒç”¨ `useState`ã€`useEffect` ç­‰å†…ç½® Hook       |
| 7ï¸âƒ£ é¿å…å‰¯ä½œç”¨æ³„æ¼         | ç”¨ `useEffect` æ¸…ç†å®šæ—¶å™¨ã€ç›‘å¬å™¨ç­‰å‰¯ä½œç”¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼           |
| 8ï¸âƒ£ ä¿æŒçŠ¶æ€éš”ç¦»          | æ¯æ¬¡è°ƒç”¨ Hook æ—¶ï¼ŒçŠ¶æ€æ˜¯ç§æœ‰ä¸”ä¸å…±äº«çš„                       |
| 9ï¸âƒ£ ç±»å‹å®šä¹‰æ¸…æ™°ï¼ˆTS é¡¹ç›®ï¼‰   | å¯¹å‚æ•°å’Œè¿”å›å€¼æ·»åŠ æ³›å‹æ”¯æŒå’Œç±»å‹å®šä¹‰ï¼Œæé«˜ä»£ç å¯é æ€§                   |
| ğŸ”Ÿ é«˜åº¦å¯æµ‹è¯•æ€§           | å°½å¯èƒ½å°†å‰¯ä½œç”¨ä¸é€»è¾‘åˆ†ç¦»ï¼Œæ–¹ä¾¿å•å…ƒæµ‹è¯•                          |

---

## 19. å¦‚ä½•åœ¨å‡½æ•°ç»„ä»¶ä¸­æ¨¡æ‹Ÿç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ
### 19.1 æ¨¡æ‹Ÿå¯¹ç…§è¡¨
| ç±»ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ                    | å‡½æ•°ç»„ä»¶ä¸­æ¨¡æ‹Ÿæ–¹å¼ï¼ˆHookï¼‰              |
| -------------------------- | ---------------------------- |
| `constructor`              | `useRef` + åˆå§‹çŠ¶æ€              |
| `componentDidMount`        | `useEffect(..., [])`         |
| `componentDidUpdate`       | `useEffect(..., [ä¾èµ–])`       |
| `componentWillUnmount`     | `useEffect` ä¸­ return æ¸…ç†å‡½æ•°    |
| `shouldComponentUpdate`    | `React.memo` / è‡ªå®šä¹‰ props æ¯”è¾ƒ  |
| `getDerivedStateFromProps` | æ‰‹åŠ¨åœ¨ `useEffect` ä¸­ç›‘å¬ props    |
| `getSnapshotBeforeUpdate`  | `useLayoutEffect` + `useRef` |
### 19.2 ç¤ºä¾‹ä»£ç 
1. componentDidMount
```js
useEffect(() => {
  console.log('ç»„ä»¶æŒ‚è½½å®Œæˆ');
}, []);
```
- ç©ºä¾èµ–æ•°ç»„ï¼Œè¡¨ç¤ºåªåœ¨åˆæ¬¡æ¸²æŸ“åæ‰§è¡Œä¸€æ¬¡
2. componentDidUpdate
```js
useEffect(() => {
  console.log('ç»„ä»¶æ›´æ–°äº† count');
}, [count]);
```
- ä¾èµ– countï¼Œåœ¨ count æ”¹å˜æ—¶æ‰§è¡Œï¼Œç»„ä»¶mountæ—¶ä¹Ÿä¼šæ‰§è¡Œä¸€æ¬¡
3. componentWillUnmount
```js
useEffect(() => {
  return () => {
    console.log('ç»„ä»¶å³å°†å¸è½½');
  };
}, []);
```
- return çš„å‡½æ•°åœ¨ç»„ä»¶å¸è½½æ—¶æ‰§è¡Œ
4. æ¨¡æ‹ŸcomponentDidMount + componentDidUpdate
```js
const isFirst = useRef(true);
useEffect(() => {
  if (isFirst.current) {
    isFirst.current = false;
    console.log('é¦–æ¬¡æŒ‚è½½');
  } else {
    console.log('æ›´æ–°é˜¶æ®µ');
  }
}, [someProp]);
```
- useRefç”¨æ¥åˆ¤æ–­æ˜¯å¦æ˜¯ç¬¬ä¸€æ¬¡æ¸²æŸ“
5. getSnapshotBeforeUpdate
```js
const prevHeight = useRef(0);
useLayoutEffect(() => {
  prevHeight.current = divRef.current.offsetHeight;
}, [someValue]);
```
- åœ¨ DOM æ›´æ–°å‰è¯»å– DOM çŠ¶æ€ã€‚
### 19.3 æ¸…ç†å‡½æ•°çš„æ‰§è¡Œ
1. ä¾èµ–é¡¹å˜åŒ–æ—¶
- æ¯æ¬¡ä¾èµ–é¡¹å‘ç”Ÿå˜åŒ–ï¼ŒReactä¼šå…ˆæ‰§è¡Œä¸Šä¸€æ¬¡çš„æ¸…ç†å‡½æ•°ï¼Œå†æ‰§è¡Œæ–°çš„å‰¯ä½œç”¨å‡½æ•°ã€‚
2. ç»„ä»¶å¸è½½æ—¶ï¼ˆunmountï¼‰
- ç»„ä»¶è¢«é”€æ¯æ—¶ï¼ŒReact ä¼šè‡ªåŠ¨è°ƒç”¨æœ€åä¸€æ¬¡çš„ æ¸…ç†å‡½æ•°ï¼Œç›¸å½“äº componentWillUnmountã€‚

---

## 20. Reacté‡Œé¢Keyçš„ä½œç”¨
### 20.1 æ€»ç»“
React ä¸­çš„ key æ˜¯ç”¨äºæ ‡è¯†åˆ—è¡¨ä¸­å…ƒç´ èº«ä»½çš„å”¯ä¸€æ ‡è¯†ï¼Œæ ¸å¿ƒç›®çš„æ˜¯æå‡è™šæ‹Ÿ DOM çš„ diff æ•ˆç‡ã€‚å®ƒå¸®åŠ© React ç²¾å‡†åˆ¤æ–­å“ªäº›èŠ‚ç‚¹éœ€è¦åˆ›å»ºã€æ›´æ–°æˆ–åˆ é™¤ã€‚æˆ‘ä»¬æ¨èä½¿ç”¨ç¨³å®šã€å”¯ä¸€çš„å€¼ï¼ˆå¦‚æ•°æ® IDï¼‰ä½œä¸º keyï¼Œè€Œä¸æ¨èä½¿ç”¨æ•°ç»„ä¸‹æ ‡ï¼Œå› ä¸ºé¡ºåºå˜åŒ–æ—¶å¯èƒ½å¯¼è‡´ç»„ä»¶é”™è¯¯å¤ç”¨ï¼Œè¿›è€Œå¼•å‘ UI é—ªçƒæˆ–çŠ¶æ€é”™ä¹±é—®é¢˜ã€‚
### 20.2 ä¸ºä»€ä¹ˆéœ€è¦key
å½“ä½¿ç”¨mapæ¸²æŸ“ä¸€ç»„å…ƒç´ æ—¶
```js
{items.map(item => (
  <li key={item.id}>{item.name}</li>
))}
```
å¦‚æœæ²¡æœ‰ keyï¼Œæˆ–æ‰€æœ‰å…ƒç´ çš„ key éƒ½ä¸€æ ·ï¼ŒReact åœ¨æ›´æ–°åˆ—è¡¨æ—¶åªèƒ½æŒ‰é¡ºåºæ¯”è¾ƒæ¯ä¸€é¡¹ï¼Œä¸€æ—¦ä¸­é—´æ’å…¥/åˆ é™¤æŸé¡¹ï¼Œå°±å¯èƒ½å¯¼è‡´é”™è¯¯å¤ç”¨å’Œæ€§èƒ½æµªè´¹ã€‚
### 20.3 æœ‰keyå’Œæ²¡keyçš„åŒºåˆ«
ç»„ä»¶[A, B, C]æ›´æ”¹ä¸º[B, C, D]
1. æœ‰key
```js
key: A â†’ è¢«åˆ é™¤  
key: D â†’ è¢«æ·»åŠ   
key: B/C â†’ å¤ç”¨
```
2. æ— key
```js
React å¯èƒ½å¤ç”¨é”™ä½ç½®ï¼š
- A â†’ å˜æˆ Bï¼ˆé”™è¯¯å¤ç”¨ï¼‰
- B â†’ å˜æˆ Cï¼ˆé”™è¯¯å¤ç”¨ï¼‰
- C â†’ å˜æˆ Dï¼ˆé”™è¯¯å¤ç”¨ï¼‰
```
---


